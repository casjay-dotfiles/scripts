#!/usr/bin/env bash
# shellcheck shell=bash
# - - - - - - - - - - - - - - - - - - - - - - - - -
##@Version           :  202602061936-git
# @@Author           :  Jason Hempstead
# @@Contact          :  jason@casjaysdev.pro
# @@License          :  WTFPL
# @@ReadME           :  screen-new --help
# @@Copyright        :  Copyright: (c) 2026 Jason Hempstead, Casjays Developments
# @@Created          :  Friday, Feb 06, 2026 09:24 EST
# @@File             :  screen-new
# @@Description      :  Completions for screen-new session manager
# @@Changelog        :
# @@TODO             :  Better documentation
# @@Other            :
# @@Resource         :
# @@Terminal App     :  no
# @@sudo/root        :  no
# @@Template         :  completions/system
# - - - - - - - - - - - - - - - - - - - - - - - - -
# shellcheck disable=SC1001,SC1003,SC2001,SC2003,SC2016,SC2031,SC2090,SC2115,SC2120,SC2155,SC2199,SC2229,SC2317,SC2329
# - - - - - - - - - - - - - - - - - - - - - - - - -
_screen-new_completion() {
  local cur prev
  # Fallback if _init_completion is not available
  if declare -F _init_completion &>/dev/null; then
    local words cword
    _init_completion || return
  fi
  cur="${COMP_WORDS[$COMP_CWORD]}"
  prev="${COMP_WORDS[$COMP_CWORD - 1]:-}"
  # Match ARRAY from script: a,attach,ls,list,kill,d,detach,edit
  local subcmds="a attach ls list kill d detach edit"
  # Match LONGOPTS from script: completions:,config,reset,debug,dir:,help,options,raw,version,silent,force
  local longopts="--completions --config --reset --debug --dir --help --options --raw --version --silent --force"
  # Helper: get active sn-* session names without the sn- prefix
  __sn_sessions() { screen -ls 2>/dev/null | grep '\.sn-' | sed 's/.*\.sn-//;s/[[:space:]].*//'; }
  # Options always available
  if [[ ${cur} == -* ]]; then
    COMPREPLY=($(compgen -W "${longopts}" -- "${cur}"))
    return 0
  fi
  # Handle subcommands
  case "${COMP_WORDS[1]}" in
  a | attach | kill | d | detach | edit)
    # All these complete with existing sessions
    if [ $COMP_CWORD -eq 2 ]; then
      local sessions="$(__sn_sessions)"
      # kill also allows "all"
      [[ "${COMP_WORDS[1]}" == "kill" ]] && sessions="$sessions all"
      COMPREPLY=($(compgen -W "${sessions}" -- "${cur}"))
    fi
    return 0
    ;;
  ls | list)
    # No completions needed
    return 0
    ;;
  --completions)
    if [ $COMP_CWORD -eq 2 ]; then
      COMPREPLY=($(compgen -W 'long short list array' -- "${cur}"))
    fi
    return 0
    ;;
  --debug | --raw | --silent | --force)
    # After flags, complete with subcommands or sessions
    local sessions="$(__sn_sessions)"
    COMPREPLY=($(compgen -W "${subcmds} ${sessions}" -- "${cur}"))
    return 0
    ;;
  --dir)
    # Complete with directories
    COMPREPLY=($(compgen -d -- "${cur}"))
    return 0
    ;;
  --help | --version | --config | --reset | --options)
    # No further completions
    return 0
    ;;
  esac
  # First argument: subcommands, existing sessions, directories
  if [ $COMP_CWORD -eq 1 ]; then
    local sessions="$(__sn_sessions)"
    COMPREPLY=($(compgen -W "${subcmds} ${sessions}" -- "${cur}") $(compgen -d -- "${cur}"))
    COMPREPLY=($(printf '%s\n' "${COMPREPLY[@]}" | sort -u))
  fi
} &&
  complete -F _screen-new_completion screen-new

# ex: ts=2 sw=2 et filetype=sh
