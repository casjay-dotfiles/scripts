.\" Manpage for buildx
.TH man 1 "02 February 2026" "202602020740-git" "buildx"

.SH NAME
buildx \- Docker buildx wrapper for multi-platform container builds

.SH DESCRIPTION
A comprehensive wrapper around Docker buildx that provides multi-platform container building capabilities with support for multiple registries, automatic tagging, version-specific configurations, and build automation. Integrates with gen-dockerfile and .env.scripts for automated configuration management.

.SH SYNOPSIS
buildx [options] [command] [dockerfile]

.SH COMMANDS
.TP
.B init
Setup docker to use buildx with multi-platform support
.TP
.B status
Get buildx status and configuration info
.TP
.B version
Show version information for buildx components
.TP
.B all
Build all Dockerfiles in the current directory
.TP
.B run [dockerfile]
Build a specific dockerfile
.TP
.B build [files...]
Build specified dockerfile(s)
.TP
.B cron [dirs...]
Automated build for directories (cron mode)
.TP
.B automated [dirs...]
Same as cron - automated build mode

.SH API COMMANDS
.TP
.B api list
List all available images in repository
.TP
.B api search [query]
Search for an image
.TP
.B api sources [query]
Lookup sources used to build image
.TP
.B api clone [repo]
Clone the source repository
.TP
.B api tags [repo/image]
List available tags for an image
.TP
.B api delete [repo]
Delete a repository
.TP
.B api update [repo]
Update repository metadata

.SH OPTIONS
.TP
.B \-\-registry [url]
Set container registry (supports multiple registries via multiple calls or comma-separated list). See REGISTRY FORMATS below.
.TP
.B \-\-tag [tag]
Set image tag (supports multiple tags via multiple calls or comma-separated list)
.TP
.B \-\-url [full-url]
Specify complete custom image URL with smart completion
.TP
.B \-\-repo [name]
Set repository name
.TP
.B \-\-user [name]
Set user/organization name
.TP
.B \-\-image [name]
Set image name (overrides auto-detection)
.TP
.B \-\-platform [arch]
Set target platform (x64, arm, arm64, or full platform string)
.TP
.B \-\-dir [path]
Set working directory
.TP
.B \-\-files [subdir]
Specify Dockerfile directory (e.g., containers, docker) - searches this subdirectory before default locations
.TP
.B \-\-no-registry
Disable additional registries
.TP
.B \-\-no-repo
Clear repository setting
.TP
.B \-\-force
Force rebuild/reinstall of buildx components
.TP
.B \-\-cleanup
Enable container cleanup after build
.TP
.B \-\-gen-script
Generate build script without executing
.TP
.B \-\-script
Use custom build.sh script if available
.TP
.B \-\-no-pull
Skip pulling updated image after build
.TP
.B \-\-help
Display this help message
.TP
.B \-\-version
Display current version
.TP
.B \-\-config
Create user configuration file
.TP
.B \-\-options
Show all available options
.TP
.B \-\-debug
Enable debugging output
.TP
.B \-\-raw
Remove all formatting from output

.SH ENVIRONMENT VARIABLES

.SS .env.scripts Variables
The buildx script sources .env.scripts files in this order:
.RS
1. .env.scripts (base configuration)
.br
2. .env.scripts.$version (version-specific configuration)
.RE

.TP
.B ENV_IMAGE_PUSH
Complete push destination - primary variable for specifying where to push images.
.br
.B Formats:
.RS
.TP
{registry}/{org}/{repo}
Full path with custom registry
.br
Example: ghcr.io/casjaysdev/myapp
.br
Parses to: registry=ghcr.io, org=casjaysdev, image=myapp
.TP
{org}/{repo}
Docker Hub format (assumes docker.io)
.br
Example: casjaysdev/myapp
.br
Parses to: registry=docker.io, org=casjaysdev, image=myapp
.RE

.TP
.B ENV_ADD_IMAGE_PUSH
Additional push destinations - comma-separated list of additional registries/repos to push to.
.br
Uses same formats as ENV_IMAGE_PUSH.
.br
Example: ghcr.io/org/repo,quay.io/org/repo,registry.company.com/org/repo

.TP
.B ENV_ORG_NAME
Organization/User name - overrides the organization/user for the image.
.br
Note: ENV_IMAGE_PUSH can override this if it contains org/repo format.
.br
Example: casjaysdev

.TP
.B ENV_IMAGE_NAME
Image name - overrides the image/repo name.
.br
Note: ENV_IMAGE_PUSH can override this if it contains org/repo format.
.br
Example: myapp

.TP
.B ENV_IMAGE_TAG
Default tag - primary tag for the image.
.br
Example: latest

.TP
.B ENV_ADD_TAGS
Additional tags - comma-separated list of additional tags.
.br
Special value: USE_DATE - automatically replaced with current date in YYYYMMDD format
.br
Example: v1.0,stable,USE_DATE
.br
Results in: v1.0, stable, 20251125

.TP
.B ENV_BUILDX_PROJECT_DIR
Project directory - override the project directory path.
.br
Example: /path/to/project

.SS BUILDX_ Runtime Variables

.TP
.B BUILDX_SET_REGISTRY
Primary and additional registries - comma-separated list.
.br
First registry becomes primary (BUILDX_DEFAULT_REGISTRY).
.br
All registries stored in BUILDX_ADD_REGISTRY for processing.
.br
Uses smart detection to differentiate between registry hostnames and org names.
.br
Supports four formats per registry entry (same logic as ENV_IMAGE_PUSH):
.RS
.TP
registry/org/repo
Full path with registry, organization, and repository
.br
Example: ghcr.io/casjaysdev/myapp
.br
Detection: First component contains . or : (registry hostname)
.TP
org/repo
Docker Hub format (assumes docker.io registry)
.br
Example: casjaysdev/myapp → docker.io/casjaysdev/myapp
.br
Detection: First component has no . or : (organization name)
.TP
registry/org
Registry with organization (uses current directory name for repo)
.br
Example: ghcr.io/casjaysdev
.br
Detection: First component contains . or : (registry hostname)
.TP
registry
Registry hostname only (uses current directory structure for org/repo)
.br
Example: ghcr.io
.RE
.br
Multiple registries example: ghcr.io/casjaysdev/myapp,casjaysdev/myapp,quay.io

.TP
.B BUILDX_SET_ORG
Organization/User name for runtime override.
.br
Example: casjaysdev

.TP
.B BUILDX_SET_IMAGE
Image/Repository name for runtime override.
.br
Example: myapp

.TP
.B BUILDX_SET_VERSION
Primary version tag for runtime override.
.br
Example: latest

.TP
.B BUILDX_VERSION_TAG
Additional version tags - space or comma-separated.
.br
Example: v1.0 stable latest

.TP
.B BUILDX_ADD_REPO
Additional repository namespace - used with multiple registries.
.br
Example: namespace

.TP
.B BUILDX_DOCKER_PLATFORMS
Build platforms - comma-separated list.
.br
Default: linux/amd64,linux/arm64
.br
Example: linux/amd64,linux/arm64,linux/arm/v7

.TP
.B BUILDX_BUILDER_NAME
Builder instance name.
.br
Default: mybuilder

.TP
.B BUILDX_DOCKER_CMD
Docker command to use.
.br
Default: docker
.br
Example: podman

.TP
.B BUILDX_PROJECT_DIR
Project directory.
.br
Default: $HOME/Projects/github

.TP
.B BUILDX_DOCKERFILE_DIR
Dockerfile directory - where to find Dockerfile.
.br
Example: ./docker

.TP
.B BUILDX_GIT_REPO_USER
Git repository user.
.br
Example: casjay

.TP
.B BUILDX_GIT_REPO_PROVIDER
Git provider URL.
.br
Default: http://github.com

.TP
.B BUILDX_REMOVE_BUILD
Remove build after completion.
.br
Values: true, false

.TP
.B BUILDX_FORCE
Force rebuild.
.br
Values: true, false

.TP
.B BUILDX_DOCKER_BUILD_EXPERIMENTAL
Enable experimental build features.
.br
Default: 1

.TP
.B BUILDX_DOCKER_CLI_EXPERIMENTAL
Enable experimental CLI features.
.br
Default: enabled

.TP
.B BUILDX_BUILD_DATE_TAG_FORMAT
Date format for tags.
.br
Default: %Y%m%d
.br
Results in: 20251125

.SH REGISTRY FORMATS
The following registry formats are supported by ENV_IMAGE_PUSH, ENV_ADD_IMAGE_PUSH, and BUILDX_SET_REGISTRY.
All three variables use the same smart detection logic to differentiate between registry hostnames and organization names.

.SS Smart Format Detection
The script detects the format by checking if the first component contains a period (.) or colon (:).
.br
If present, it's treated as a registry hostname. If not, it's treated as an organization name (Docker Hub assumed).

.SS Supported Formats

.TP
.B registry/org/repo - Full Path
Complete specification with registry, organization, and repository.
.br
Examples:
.br
  ghcr.io/casjaysdev/myapp
.br
  quay.io/casjaysdev/myapp
.br
  registry.company.com/casjaysdev/myapp
.br
  registry.company.com:5000/casjaysdev/myapp (with port)
.br
Detection: First component contains . or :

.TP
.B org/repo - Docker Hub Format
Organization and repository only (assumes docker.io registry).
.br
Examples:
.br
  casjaysdev/myapp → docker.io/casjaysdev/myapp
.br
  ubuntu/nginx → docker.io/ubuntu/nginx
.br
Detection: First component has no . or :

.TP
.B registry/org - Registry with Organization
Registry and organization (uses current directory name for repository).
.br
Examples:
.br
  ghcr.io/casjaysdev
.br
  quay.io/casjaysdev
.br
  docker.io/casjaysdev
.br
Detection: First component contains . or :

.TP
.B registry - Registry Only
Registry hostname only (uses current directory structure for org/repo).
.br
Examples:
.br
  ghcr.io
.br
  docker.io
.br
  quay.io
.br
  registry.company.com

.SS Multiple Registries
All registry variables support comma-separated lists for multi-registry pushes.
Each entry in the list can use any of the four formats above.
.br
Examples:
.br
  ENV_ADD_IMAGE_PUSH="ghcr.io/casjaysdev/app,docker.io/casjaysdev/app,quay.io"
.br
  BUILDX_SET_REGISTRY="ghcr.io/casjaysdev/app,casjaysdev/app,quay.io"
.br
.br
In the second example, the script will push to:
.br
  1. ghcr.io/casjaysdev/app (full path from first entry)
.br
  2. docker.io/casjaysdev/app (Docker Hub format from second entry)
.br
  3. quay.io/casjaysdev/[current-dir] (registry only from third entry)

.SH VARIABLE PRIORITY
Variables are processed in this priority order, with higher priority values overriding lower ones.
Understanding this order is critical for proper configuration management.

.SS Priority Order (Highest to Lowest)

.TP
.B 1. Command Line Flags
Options passed directly to the buildx command.
.br
Examples: --registry, --tag, --platform, --user, --image
.br
These always take precedence over all other configuration methods.

.TP
.B 2. ENV_ Variables from .env.scripts.$version
Version-specific environment variables from .env.scripts.$version files.
.br
Examples: .env.scripts.latest, .env.scripts.v1.0, .env.scripts.stable
.br
Allows per-version customization of build settings.

.TP
.B 3. ENV_ Variables from .env.scripts
Base environment variables from .env.scripts file.
.br
Variables: ENV_IMAGE_PUSH, ENV_ADD_IMAGE_PUSH, ENV_IMAGE_TAG, ENV_ADD_TAGS, ENV_ORG_NAME, ENV_IMAGE_NAME
.br
Primary configuration method for project-specific builds.

.TP
.B 4. BUILDX_ Environment Variables
Runtime environment variables set in shell or system environment.
.br
Variables: BUILDX_SET_REGISTRY, BUILDX_SET_ORG, BUILDX_SET_IMAGE, BUILDX_SET_VERSION, BUILDX_DOCKER_PLATFORMS
.br
Useful for temporary overrides or CI/CD pipelines.

.TP
.B 5. Config File Settings
User configuration from ~/.config/myscripts/buildx/settings.conf
.br
Persistent user preferences and defaults.

.TP
.B 6. Built-in Defaults
Hard-coded defaults in the script.
.br
Examples: linux/amd64,linux/arm64 for platforms, docker.io for registry

.SS Priority Examples

.TP
.B Example 1: Command line overrides everything
.nf
# .env.scripts has: ENV_IMAGE_TAG="latest"
# Command: buildx --tag v1.0
# Result: Uses v1.0 (command line wins)
.fi

.TP
.B Example 2: Version-specific override
.nf
# .env.scripts has: ENV_IMAGE_TAG="latest"
# .env.scripts.v1.0 has: ENV_IMAGE_TAG="v1.0"
# When building v1.0: Uses v1.0 (version-specific wins)
.fi

.TP
.B Example 3: ENV_IMAGE_PUSH overrides ENV_ORG_NAME and ENV_IMAGE_NAME
.nf
# .env.scripts has:
# ENV_ORG_NAME="oldorg"
# ENV_IMAGE_NAME="oldname"
# ENV_IMAGE_PUSH="ghcr.io/neworg/newname"
# Result: Uses neworg/newname (ENV_IMAGE_PUSH wins)
.fi

.SS Variable Interaction Notes

- ENV_IMAGE_PUSH takes priority over ENV_ORG_NAME and ENV_IMAGE_NAME when parsing registry/org/repo
- Command line --registry takes priority over ENV_IMAGE_PUSH for registry selection
- BUILDX_SET_REGISTRY overrides all ENV_ registry settings when set
- ENV_ADD_TAGS supplements ENV_IMAGE_TAG (both are used, not override)
- ENV_ADD_IMAGE_PUSH supplements ENV_IMAGE_PUSH (both are used, not override)

.SH PLATFORM SUPPORT
Supported platforms for multi-architecture builds:
.TP
.B linux/amd64
x86_64 architecture (default)
.TP
.B linux/arm64
ARM 64-bit architecture (default)
.TP
.B linux/arm/v7
ARM 32-bit v7 architecture
.TP
.B linux/arm/v6
ARM 32-bit v6 architecture
.TP
.B linux/386
x86 32-bit architecture
.TP
.B linux/ppc64le
PowerPC 64-bit Little Endian
.TP
.B linux/s390x
IBM System z architecture

.SH EXAMPLES
.TP
.B buildx init
Initialize buildx with multi-platform support

.TP
.B buildx
Build Dockerfile in current directory using .env.scripts configuration

.TP
.B buildx all
Build all Dockerfiles in current directory

.TP
.B buildx \-\-registry ghcr.io \-\-user myorg \-\-repo myapp
Build and push to GitHub Container Registry with custom org/repo

.TP
.B buildx \-\-registry ghcr.io,docker.io \-\-tag latest,v1.0
Build and push to multiple registries with multiple tags

.TP
.B buildx \-\-platform linux/amd64,linux/arm64 \-\-tag stable
Build for multiple platforms with specific tag

.TP
.B buildx \-\-files containers
Build using Dockerfile in containers/ subdirectory

.TP
.B buildx cron /path/to/projects
Automated build for all projects in directory

.TP
.B BUILDX_DOCKER_PLATFORMS="linux/amd64,linux/arm64,linux/arm/v7" buildx
Build for three platforms using environment variable

.SH .env.scripts EXAMPLES

.SS Example 1: GitHub Container Registry
.nf
# .env.scripts
ENV_IMAGE_PUSH="ghcr.io/casjaysdev/myapp"
ENV_IMAGE_TAG="latest"
ENV_ADD_TAGS="v1.0,stable,USE_DATE"
.fi

.SS Example 2: Multiple Registries
.nf
# .env.scripts
ENV_IMAGE_PUSH="ghcr.io/casjaysdev/myapp"
ENV_ADD_IMAGE_PUSH="docker.io/casjaysdev/myapp,quay.io/casjaysdev/myapp"
ENV_IMAGE_TAG="latest"
ENV_ADD_TAGS="v1.0,stable"
.fi

Results in pushes to:
.br
- ghcr.io/casjaysdev/myapp:latest
.br
- ghcr.io/casjaysdev/myapp:v1.0
.br
- ghcr.io/casjaysdev/myapp:stable
.br
- docker.io/casjaysdev/myapp:latest
.br
- docker.io/casjaysdev/myapp:v1.0
.br
- docker.io/casjaysdev/myapp:stable
.br
- quay.io/casjaysdev/myapp:latest
.br
- quay.io/casjaysdev/myapp:v1.0
.br
- quay.io/casjaysdev/myapp:stable

.SS Example 3: Organization and Image Name Override
.nf
# .env.scripts
ENV_ORG_NAME="customorg"
ENV_IMAGE_NAME="customname"
ENV_IMAGE_PUSH="ghcr.io/casjaysdev/myapp"
.fi

Note: ENV_IMAGE_PUSH takes priority and will use "casjaysdev" and "myapp" instead of "customorg" and "customname".

.SS Example 4: Version-Specific Configuration
.nf
# .env.scripts (base)
ENV_IMAGE_PUSH="ghcr.io/casjaysdev/myapp"
ENV_IMAGE_TAG="latest"

# .env.scripts.v1.0 (version override)
ENV_IMAGE_TAG="v1.0"
ENV_ADD_TAGS="stable"
.fi

When building with v1.0, the script sources both files and uses the version-specific tag.

.SH FILES
.TP
.I ~/.config/myscripts/buildx/settings.conf
Configuration file with buildx settings
.TP
.I ~/.local/log/buildx/
Log directory organized by registry/org/repo/version.log
.TP
.I .env.scripts
Project-specific environment variables (created by gen-dockerfile)
.TP
.I .env.scripts.$version
Version-specific environment variables (e.g., .env.scripts.latest, .env.scripts.v1.0)
.TP
.I /usr/local/bin/buildx
Main buildx script executable

.SH NOTES
.TP
.B Multi-Registry Support
When using ENV_ADD_IMAGE_PUSH or comma-separated registries, buildx will push to all specified registries with all specified tags.

.TP
.B Tag Processing
Tags are applied to all registries. If you specify 3 registries and 3 tags, you get 9 total image pushes (3 registries × 3 tags).

.TP
.B Version-Specific Configs
The .env.scripts.$version files allow per-version customization. For example, you might have different tags or additional registries for specific versions.

.TP
.B Date Tags
USE_DATE in ENV_ADD_TAGS is replaced with the current date in YYYYMMDD format (default) or custom format via BUILDX_BUILD_DATE_TAG_FORMAT.

.TP
.B Platform Detection
If BUILDX_DOCKER_PLATFORMS is not set, buildx uses the default platforms: linux/amd64,linux/arm64. Override via environment variable or config file.

.TP
.B Variable Override Order
Command line options always override .env.scripts variables, which override config file settings, which override built-in defaults.

.SH INTEGRATION
.TP
.B gen-dockerfile
The gen-dockerfile tool automatically creates .env.scripts files with proper ENV_ variables based on prompts. This integrates seamlessly with buildx for zero-configuration builds.

.TP
.B Docker Hub
When using Docker Hub, the registry can be omitted (org/repo format) or explicitly specified as docker.io.

.TP
.B GitHub Container Registry
Use ghcr.io/org/repo format for GitHub Container Registry. Requires GitHub personal access token with appropriate permissions.

.SH LICENSE
WTFPL

.SH BUGS
No known bugs.

.SH REPORTING BUGS
https://github.com/casjay-dotfiles/issues

.SH AUTHOR
Currently maintained by Jason Hempstead <jason@casjaysdev.pro>

.SH SEE ALSO
docker-buildx(1), gen-dockerfile(1)
