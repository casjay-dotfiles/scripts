.TH DMENU-USB "1" "December 2025" "dmenu-usb 202208052152-git" "User Commands"
.SH NAME
dmenu-usb \- Interactive USB and Android device mount/unmount tool with dmenu/rofi interface
.SH SYNOPSIS
.B dmenu-usb
[\fI\,OPTIONS\/\fR] [\fI\,COMMAND\/\fR]
.SH DESCRIPTION
.B dmenu-usb
is an interactive device management tool that provides a dmenu/rofi interface for mounting and unmounting USB drives and Android devices (MTP). It uses lsblk for device detection, handles multiple filesystem types, and integrates with sudo for privileged mount operations.
.PP
The script automatically detects available USB drives and Android devices, presents them in an interactive menu, and handles mount point creation, filesystem type detection, and proper unmounting with safety checks to prevent system disk unmounting.
.PP
dmenu-usb simplifies device management by providing a user-friendly interface for common mount/unmount operations, making it ideal for window manager keybindings and quick device access.
.SH COMMANDS
.TP
.B dmenu-usb
Launch interactive menu to choose mount or unmount action (default)
.TP
.B dmenu-usb mount
Show menu to mount USB drive or Android device
.TP
.B dmenu-usb unmount
Show menu to unmount USB drive or Android device (also: umount)
.SH OPTIONS
.TP
.BR \-\-help
Display help message with available commands and usage examples
.TP
.BR \-\-config
Generate or regenerate user configuration file with default settings
.TP
.BR \-\-version
Show script version information and exit
.TP
.BR \-\-options
Display all available command-line options and commands
.TP
.BR \-\-debug
Enable debug mode with verbose output and command tracing (set -x)
.TP
.BR \-\-raw
Disable colorized output for plain text display
.TP
.BR \-\-silent
Suppress non-essential output messages and notifications
.SH USAGE
.B dmenu-usb
.PP
Launch menu to choose between mount and unmount operations.
.PP
.B dmenu-usb mount
.PP
Detect available devices and present mount menu:
.RS
.IP \(bu 2
USB drives - Show unmounted USB partitions
.IP \(bu 2
Android devices - Show MTP devices via simple-mtpfs
.IP \(bu 2
Both - Present choice between USB and Android
.RE
.PP
.B dmenu-usb unmount
.PP
Detect mounted devices and present unmount menu:
.RS
.IP \(bu 2
USB drives - Show mounted USB partitions (excluding system disks)
.IP \(bu 2
Android devices - Show mounted MTP devices
.IP \(bu 2
Both - Present choice between USB and Android
.RE
.SH DEVICE DETECTION
.SS USB Drive Detection
USB drives are detected using lsblk with the following criteria:
.RS
.IP \(bu 2
Type: Partition (not whole disk)
.IP \(bu 2
Not mounted (for mount operation)
.IP \(bu 2
Mounted (for unmount operation)
.IP \(bu 2
Excluded: /boot, /efi, /home, swap partitions
.IP \(bu 2
Shows device name and size in menu
.RE
.PP
.B lsblk command for unmounted drives:
.RS
.EX
lsblk -rpo "name,type,size,mountpoint" | \\
  awk '$2=="part"&&$4==""{printf "%s (%s)\\n",$1,$3}'
.EE
.RE
.PP
.B lsblk command for mounted drives:
.RS
.EX
lsblk -nrpo "name,type,size,mountpoint" | \\
  awk '$4!~/\\/boot|\\/efi|\\/home$|SWAP/&&length($4)>1{printf "%s (%s)\\n",$4,$3}'
.EE
.RE
.SS Android Device Detection
Android devices are detected using simple-mtpfs:
.RS
.IP \(bu 2
Lists MTP-compatible Android devices
.IP \(bu 2
Requires simple-mtpfs package
.IP \(bu 2
Shows device list with indices
.IP \(bu 2
Uses simple-mtpfs for mounting
.RE
.PP
.B simple-mtpfs detection:
.RS
.EX
simple-mtpfs -l
.EE
.RE
.SH MOUNT OPERATIONS
.SS USB Drive Mounting
Mount process for USB drives:
.RS
.IP 1. 3
Select drive from menu (shows device and size)
.IP 2. 3
Choose or type mount point (browses /mnt, /media, /mount, /home)
.IP 3. 3
Create mount point if it doesn't exist (prompts for confirmation)
.IP 4. 3
Detect filesystem type with lsblk
.IP 5. 3
Mount with appropriate options based on filesystem
.IP 6. 3
Desktop notification confirms success
.RE
.PP
.B Filesystem Type Handling:
.TP
.B vfat (FAT32)
.RS
.EX
sudo mount -t vfat /dev/sdX1 /mnt/point \\
  -o rw,umask=0000
.EE
Mounted with full read/write access for all users
.RE
.TP
.B ntfs (NTFS)
.RS
.EX
sudo mount -t ntfs /dev/sdX1 /mnt/point
.EE
Standard NTFS mount (requires ntfs-3g)
.RE
.TP
.B ext4, ext3, ext2 (Linux)
.RS
.EX
sudo mount /dev/sdX1 /mnt/point
.EE
Standard Linux filesystem mount
.RE
.SS Android Device Mounting
Mount process for Android devices:
.RS
.IP 1. 3
Select device from simple-mtpfs list
.IP 2. 3
Choose or type mount point (browses $HOME with maxdepth 3)
.IP 3. 3
Create mount point if it doesn't exist
.IP 4. 3
Mount with simple-mtpfs
.IP 5. 3
Prompt to allow USB debugging on phone
.IP 6. 3
Remount after permission granted
.IP 7. 3
Desktop notification confirms success
.RE
.PP
.B simple-mtpfs mount command:
.RS
.EX
simple-mtpfs --device 1 /mnt/android
.EE
.RE
.SH UNMOUNT OPERATIONS
.SS USB Drive Unmounting
Unmount process for USB drives:
.RS
.IP 1. 3
Detect mounted drives (excluding system disks)
.IP 2. 3
Filter out excluded drives and filesystem types
.IP 3. 3
Present menu of unmountable drives
.IP 4. 3
Unmount selected drive with sudo
.IP 5. 3
Desktop notification confirms success
.RE
.PP
.B Unmount command:
.RS
.EX
sudo umount /dev/sdX1
.EE
.RE
.SS Android Device Unmounting
Unmount process for Android devices:
.RS
.IP 1. 3
Detect mounted MTP devices from /etc/mtab
.IP 2. 3
Present menu of mounted Android devices
.IP 3. 3
Unmount with lazy unmount option
.IP 4. 3
Desktop notification confirms success
.RE
.PP
.B Unmount command:
.RS
.EX
sudo umount -l /mnt/android
.EE
Lazy unmount (-l) allows unmounting even with open files
.RE
.SH SAFETY FEATURES
.SS System Disk Protection
Prevents unmounting critical system disks:
.RS
.IP \(bu 2
Excludes /boot and /efi partitions
.IP \(bu 2
Excludes /home filesystem
.IP \(bu 2
Excludes swap partitions
.IP \(bu 2
User-defined exclusions via DMENU_USB_EXCLUDE_DRIVE
.IP \(bu 2
Filesystem type exclusions via DMENU_USB_EXCLUDE_FSTYPE
.RE
.PP
.B System disk check function:
.RS
.EX
__is_system_disk() {
  # Checks against:
  # - /mnt/shared
  # - /mnt/system
  # - /mnt/backup
  # - User-defined exclusions
}
.EE
.RE
.SS Mount Point Validation
Ensures safe mount point creation:
.RS
.IP \(bu 2
Prompts before creating non-existent mount points
.IP \(bu 2
Uses sudo if user lacks permissions
.IP \(bu 2
Validates mount point before mounting
.IP \(bu 2
Shows already-mounted locations in file browser
.RE
.SH FILES
.TP
.B ~/.config/myscripts/dmenu-usb/settings.conf
User configuration file for dmenu-usb preferences
.TP
.B ~/.local/share/myscripts/dmenu-usb/backups/
Configuration backup directory
.TP
.B ~/.local/log/dmenu-usb/
Log file directory for error tracking
.TP
.B ~/.local/tmp/system_scripts/dmenu-usb/
Temporary files directory
.TP
.B ~/.cache/dmenu-usb/
Cache directory
.TP
.B /etc/mtab
System mount table (checked for mounted devices)
.SH ENVIRONMENT VARIABLES
.TP
.B DMENU_USB_CONFIG_DIR
Override default configuration directory (~/.config/myscripts/dmenu-usb/)
.TP
.B DMENU_USB_EXCLUDE_DRIVE
Comma-separated list of drives to exclude from unmount menu (e.g., /mnt/data,/mnt/backup)
.TP
.B DMENU_USB_EXCLUDE_FSTYPE
Comma-separated list of filesystem types to exclude from unmount (e.g., nfs,cifs)
.TP
.B DMENU_USB_OUTPUT_COLOR_1
Primary output color code for terminal display (default: 33 for yellow)
.TP
.B DMENU_USB_OUTPUT_COLOR_2
Secondary output color code (default: 5 for magenta)
.TP
.B DMENU_USB_OUTPUT_COLOR_GOOD
Success message color code (default: 2 for green)
.TP
.B DMENU_USB_OUTPUT_COLOR_ERROR
Error message color code (default: 1 for red)
.TP
.B DMENU_USB_NOTIFY_ENABLED
Enable/disable desktop notifications (default: yes)
.TP
.B DMENU_USB_NOTIFY_CLIENT_NAME
Customize notification client name displayed in desktop notifications
.TP
.B DMENU_USB_NOTIFY_CLIENT_ICON
Customize notification icon (default: notification-new)
.TP
.B DMENU_USB_NOTIFY_CLIENT_URGENCY
Notification urgency level: low, normal, critical (default: normal)
.TP
.B ROFI_THEME
Custom rofi theme for menu display (default: purple)
.SH CONFIGURATION FILE
The configuration file located at ~/.config/myscripts/dmenu-usb/settings.conf supports the following settings:
.PP
.RS 4
.EX
DMENU_USB_EXCLUDE_DRIVE="/mnt/backup,/mnt/system"
DMENU_USB_EXCLUDE_FSTYPE="nfs,cifs,sshfs"
DMENU_USB_NOTIFY_ENABLED="yes"
.EE
.RE
.SH EXIT STATUS
.TP
.B 0
Success - device mounted or unmounted successfully
.TP
.B 1
General error, user cancelled operation, or no devices detected
.SH EXAMPLES
.TP
.B dmenu-usb
Launch menu to choose between mount and unmount
.TP
.B dmenu-usb mount
Mount USB drive or Android device via menu
.TP
.B dmenu-usb unmount
Unmount USB drive or Android device via menu
.TP
.B DMENU_USB_EXCLUDE_DRIVE=/mnt/backup dmenu-usb unmount
Exclude /mnt/backup from unmount menu
.SH USE CASES
.SS Quick USB Drive Access
.RS
.IP 1. 3
Bind dmenu-usb to keyboard shortcut (e.g., Super+u)
.IP 2. 3
Insert USB drive
.IP 3. 3
Press hotkey, select "Mount"
.IP 4. 3
Select drive from menu
.IP 5. 3
Choose mount point
.IP 6. 3
Drive mounted and accessible
.RE
.SS Android File Transfer
.RS
.IP 1. 3
Connect Android device via USB
.IP 2. 3
Run dmenu-usb mount
.IP 4. 3
Select Android device
.IP 5. 3
Choose mount point (e.g., ~/android)
.IP 6. 3
Allow USB debugging on phone when prompted
.IP 7. 3
Access files via mount point
.IP 8. 3
Run dmenu-usb unmount when done
.RE
.SS Safe Device Removal
.RS
.IP 1. 3
Run dmenu-usb unmount
.IP 2. 3
Select device from menu (system disks excluded automatically)
.IP 3. 3
Device unmounted safely
.IP 4. 3
Physical removal safe
.RE
.SH MENU INTERFACE
dmenu-usb uses either rofi or dmenu for the interactive menu interface:
.PP
.B Menu Tool Priority:
.RS
.IP 1. 3
rofi (preferred) - Modern menu with theme support, icons, fuzzy search
.IP 2. 3
dmenu - Lightweight, fast, minimal interface
.RE
.PP
The menu will automatically use whichever tool is available, preferring rofi for enhanced features.
.PP
.B Menu Navigation:
.RS
.IP \(bu 2
Use arrow keys or type to filter options
.IP \(bu 2
Press Enter to select highlighted option
.IP \(bu 2
Press Escape to cancel operation
.IP \(bu 2
rofi supports fuzzy search for quick filtering
.RE
.SH WINDOW MANAGER INTEGRATION
.SS i3 Window Manager
.RS
.EX
# Mount device
bindsym $mod+F9 exec --no-startup-id dmenu-usb mount

# Unmount device
bindsym $mod+Shift+F9 exec --no-startup-id dmenu-usb unmount

# Interactive (choose mount or unmount)
bindsym $mod+u exec --no-startup-id dmenu-usb
.EE
.RE
.SS dwm/suckless
Configure in config.h:
.RS
.EX
static const char *dmenumount[] = { "dmenu-usb", "mount", NULL };
static const char *dmenuumount[] = { "dmenu-usb", "unmount", NULL };
static Key keys[] = {
    { MODKEY, XK_F9, spawn, {.v = dmenumount } },
    { MODKEY|ShiftMask, XK_F9, spawn, {.v = dmenuumount } },
};
.EE
.RE
.SS Openbox
.RS
.EX
<keybind key="W-F9">
  <action name="Execute">
    <command>dmenu-usb mount</command>
  </action>
</keybind>
<keybind key="W-S-F9">
  <action name="Execute">
    <command>dmenu-usb unmount</command>
  </action>
</keybind>
.EE
.RE
.SH NOTES
.IP \(bu 2
Requires X11 window system for dmenu/rofi
.IP \(bu 2
Mount operations require sudo access
.IP \(bu 2
Android support requires simple-mtpfs package
.IP \(bu 2
FAT32 drives mounted with umask=0000 for full access
.IP \(bu 2
NTFS support requires ntfs-3g package
.IP \(bu 2
System disks automatically excluded from unmount
.IP \(bu 2
Desktop notifications require notification daemon
.IP \(bu 2
Mount points created automatically with user confirmation
.IP \(bu 2
Android devices require USB debugging permission
.IP \(bu 2
Lazy unmount (-l) used for Android devices
.SH TROUBLESHOOTING
.SS No Devices Detected
.RS
.IP \(bu 2
Check if device is properly connected
.IP \(bu 2
Run lsblk to verify device detection
.IP \(bu 2
For Android: ensure USB debugging enabled
.IP \(bu 2
For Android: install simple-mtpfs package
.RE
.SS Mount Permission Denied
.RS
.IP \(bu 2
Verify user has sudo access
.IP \(bu 2
Check /etc/sudoers configuration
.IP \(bu 2
Ensure mount point is not already in use
.IP \(bu 2
Verify filesystem driver installed (ntfs-3g, etc.)
.RE
.SS Android Device Not Mounting
.RS
.IP \(bu 2
Install simple-mtpfs: sudo apt install simple-mtpfs
.IP \(bu 2
Enable USB debugging on Android device
.IP \(bu 2
Allow USB debugging permission when prompted
.IP \(bu 2
Try disconnecting and reconnecting device
.IP \(bu 2
Check dmesg for USB errors: dmesg | tail
.RE
.SS System Disk Appears in Menu
.RS
.IP \(bu 2
Add disk to DMENU_USB_EXCLUDE_DRIVE in config
.IP \(bu 2
Example: DMENU_USB_EXCLUDE_DRIVE="/mnt/system,/mnt/backup"
.IP \(bu 2
Regenerate config: dmenu-usb --config
.IP \(bu 2
Edit ~/.config/myscripts/dmenu-usb/settings.conf
.RE
.SS Menu Not Appearing
.RS
.IP \(bu 2
Install rofi: sudo apt install rofi or sudo pacman -S rofi
.IP \(bu 2
Install dmenu: sudo apt install dmenu or sudo pacman -S dmenu
.IP \(bu 2
Check if running in X11 session (not Wayland)
.IP \(bu 2
Verify DISPLAY environment variable is set
.RE
.SH DEPENDENCIES
.TP
.B Required:
.RS
.IP \(bu 2
bash - Bash shell for script execution
.IP \(bu 2
lsblk - List block devices (util-linux)
.IP \(bu 2
mount - Mount filesystems (util-linux)
.IP \(bu 2
umount - Unmount filesystems (util-linux)
.IP \(bu 2
sudo - Execute commands as root
.IP \(bu 2
rofi OR dmenu - Menu interface (at least one required)
.RE
.TP
.B Optional:
.RS
.IP \(bu 2
simple-mtpfs - Android MTP device mounting
.IP \(bu 2
ntfs-3g - NTFS filesystem support
.IP \(bu 2
notify-send - Desktop notifications (libnotify)
.IP \(bu 2
find - Browse directories for mount points
.RE
.SH BUGS
Report bugs at: https://github.com/casjay-dotfiles/scripts/issues
.SH AUTHOR
Written by Jason Hempstead (CasjaysDev)
.SH COPYRIGHT
Copyright \(co 2022 Jason Hempstead, Casjays Developments
.br
License: WTFPL (Do What The F*** You Want To Public License)
.SH SEE ALSO
.BR lsblk (8),
.BR mount (8),
.BR umount (8),
.BR rofi (1),
.BR dmenu (1),
.BR simple-mtpfs (1)
.PP
Related tools:
.br
udiskie: https://github.com/coldfix/udiskie
.br
udisks2: https://www.freedesktop.org/wiki/Software/udisks/
.br
pcmanfm: File manager with built-in mount support
