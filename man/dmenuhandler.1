.TH DMENUHANDLER "1" "December 2025" "dmenuhandler 202208051342-git" "User Commands"
.SH NAME
dmenuhandler \- Interactive URL and link handler with dmenu/rofi interface
.SH SYNOPSIS
.B dmenuhandler
[\fI\,OPTIONS\/\fR] [\fI\,URL\/\fR]
.SH DESCRIPTION
.B dmenuhandler
is a versatile URL and link handler that presents an interactive menu for choosing how to open URLs, media links, or files. It integrates with dmenu or rofi to provide a clean selection interface for various opening methods including media players, web browsers, image viewers, download queues, and clipboard operations.
.PP
The script is designed to be used as the default handler for URLs in window managers, browsers, RSS readers, email clients, or any application that needs to open external links. It provides consistent, user-controlled behavior for all URL types.
.PP
dmenuhandler automatically detects available applications and presents appropriate options, making it a flexible choice for different system configurations and use cases.
.SH OPTIONS
.TP
.BR \-\-help
Display help message with usage information and available options
.TP
.BR \-\-config
Generate or regenerate user configuration file with default settings
.TP
.BR \-\-version
Show script version information and exit
.TP
.BR \-\-options
Display all available command-line options
.TP
.BR \-\-debug
Enable debug mode with verbose output and command tracing (set -x)
.TP
.BR \-\-raw
Disable colorized output for plain text display
.TP
.BR \-\-silent
Suppress non-essential output messages and notifications
.SH USAGE
.B dmenuhandler
[\fIURL\fR]
.PP
Feed the script a URL and it will present a menu with options for how to open it:
.RS
.IP \(bu 2
copy url - Copy URL to clipboard
.IP \(bu 2
mpv - Play in mpv media player
.IP \(bu 2
mpv (loop) - Play looped in mpv with IPC socket
.IP \(bu 2
queue download - Queue file download via tsp (task spooler)
.IP \(bu 2
queue youtube-dl - Queue YouTube download with metadata
.IP \(bu 2
feh - Open image in feh viewer
.IP \(bu 2
browser - Open in default web browser
.IP \(bu 2
w3m - Open in w3m terminal browser
.IP \(bu 2
mpv (float) - Play in floating mpv window (30% size, corner positioned)
.RE
.SH MENU OPTIONS
.SS copy url
Copies the URL to the system clipboard using the
.B clipboard
command. Useful for pasting into other applications or saving for later.
.SS mpv
Opens the URL in mpv media player in the background. Suitable for video and audio streaming. mpv handles various protocols including HTTP, HTTPS, YouTube, and many streaming services.
.SS mpv (loop)
Opens the URL in mpv with looping enabled and creates an IPC socket for remote control. The socket is named with a timestamp (/tmp/mpvsoc[timestamp]) allowing external control of playback.
.SS queue download
Queues the URL for download using tsp (task spooler). Downloads run in the background and can be managed with tsp commands. Downloaded file saves to current directory with original filename.
.SS queue youtube-dl
Queues YouTube video download using youtube-dl with metadata embedding enabled. Runs in background via tsp, allowing multiple queued downloads. Downloads video with best available quality and writes metadata tags.
.SS feh
Opens the URL as an image in feh image viewer. Suitable for direct image URLs. feh runs in the background allowing continued work while viewing.
.SS browser
Opens the URL in the default web browser specified by the $BROWSER environment variable. Falls back to system default if $BROWSER is not set.
.SS w3m
Opens the URL in w3m terminal-based web browser. Useful for quick text-based browsing or when working in a terminal-only environment. Runs in foreground.
.SS mpv (float)
Opens the URL in mpv with floating window configuration: 30% screen size, positioned in corner, with IPC socket for control. Ideal for picture-in-picture viewing while working on other tasks.
.SH EXAMPLES
.TP
.B dmenuhandler "https://example.com/video.mp4"
Opens menu to choose how to handle video URL
.TP
.B dmenuhandler "https://www.youtube.com/watch?v=..."
Opens menu with YouTube-specific options (mpv, youtube-dl, browser)
.TP
.B dmenuhandler "https://example.com/image.png"
Opens menu including image viewer options
.TP
.B dmenuhandler "https://example.com/file.pdf"
Opens menu to download or open in browser
.SH FILES
.TP
.B ~/.config/myscripts/dmenuhandler/settings.conf
User configuration file for dmenuhandler preferences
.TP
.B ~/.config/myscripts/dmenuhandler/backups/
Configuration backup directory
.TP
.B ~/.local/log/dmenuhandler/
Log file directory for error tracking
.TP
.B ~/.local/tmp/system_scripts/dmenuhandler/
Temporary files directory
.TP
.B ~/.cache/dmenuhandler/
Cache directory
.SH ENVIRONMENT VARIABLES
.TP
.B DMENUHANDLER_CONFIG_DIR
Override default configuration directory (~/.config/myscripts/dmenuhandler/)
.TP
.B BROWSER
Default web browser to use for "browser" option
.TP
.B ROFI_THEME
Custom rofi theme for menu display (default: purple)
.TP
.B DMENUHANDLER_OUTPUT_COLOR_1
Primary output color code for terminal display (default: 33 for yellow)
.TP
.B DMENUHANDLER_OUTPUT_COLOR_2
Secondary output color code (default: 5 for magenta)
.TP
.B DMENUHANDLER_OUTPUT_COLOR_GOOD
Success message color code (default: 2 for green)
.TP
.B DMENUHANDLER_OUTPUT_COLOR_ERROR
Error message color code (default: 1 for red)
.TP
.B DMENUHANDLER_NOTIFY_ENABLED
Enable/disable desktop notifications (default: yes)
.TP
.B DMENUHANDLER_NOTIFY_CLIENT_NAME
Customize notification client name displayed in desktop notifications
.TP
.B DMENUHANDLER_NOTIFY_CLIENT_ICON
Customize notification icon (default: notification-new)
.TP
.B DMENUHANDLER_NOTIFY_CLIENT_URGENCY
Notification urgency level: low, normal, critical (default: normal)
.SH CONFIGURATION FILE
The configuration file located at ~/.config/myscripts/dmenuhandler/settings.conf supports the following settings:
.PP
.RS 4
.EX
DMENUHANDLER_OUTPUT_COLOR_1="33"
DMENUHANDLER_OUTPUT_COLOR_2="5"
DMENUHANDLER_OUTPUT_COLOR_GOOD="2"
DMENUHANDLER_OUTPUT_COLOR_ERROR="1"
DMENUHANDLER_NOTIFY_ENABLED="yes"
.EE
.RE
.SH EXIT STATUS
.TP
.B 0
Success - URL handled successfully
.TP
.B 1
General error or user cancelled operation
.SH INTEGRATION
.SS Window Manager Integration
Set dmenuhandler as the default URL handler in your window manager configuration:
.PP
.B i3 window manager:
.RS
.EX
bindsym $mod+u exec dmenuhandler "$(xclip -o)"
.EE
.RE
.PP
.B dwm/suckless:
.RS
Configure in config.h or use external script to pipe URLs
.EE
.RE
.SS Browser Integration
Configure as external protocol handler in browser preferences, or use browser extensions to pass URLs to dmenuhandler.
.SS RSS Reader Integration
.B newsboat:
.RS
.EX
# In ~/.newsboat/config
browser "dmenuhandler %u"
.EE
.RE
.SS Email Client Integration
.B mutt/neomutt:
.RS
.EX
# In ~/.muttrc
macro index,pager \\\\cb "<pipe-message> urlscan<Enter>" \\
  "call dmenuhandler"
.EE
.RE
.SH MENU INTERFACE
dmenuhandler uses either rofi or dmenu for the interactive menu interface:
.PP
.B Menu Tool Priority:
.RS
.IP 1. 3
rofi (preferred) - Modern menu with theme support, icons, fuzzy search
.IP 2. 3
dmenu - Lightweight, fast, minimal interface
.RE
.PP
The menu will automatically use whichever tool is available, preferring rofi for enhanced features.
.PP
.B Menu Navigation:
.RS
.IP \(bu 2
Use arrow keys or type to filter options
.IP \(bu 2
Press Enter to select highlighted option
.IP \(bu 2
Press Escape to cancel operation
.IP \(bu 2
rofi supports fuzzy search for quick filtering
.RE
.SH USE CASES
.SS Video Streaming
.RS
.IP 1. 3
Copy video URL from website
.IP 2. 3
Run dmenuhandler with URL
.IP 3. 3
Select "mpv" for immediate playback
.IP 4. 3
Or select "queue download" to save for later
.RE
.SS Image Viewing
.RS
.IP 1. 3
Right-click image URL
.IP 2. 3
Run dmenuhandler
.IP 3. 3
Select "feh" for quick viewing
.IP 4. 3
Or "browser" for context
.RE
.SS Background Downloads
.RS
.IP 1. 3
Find large file to download
.IP 2. 3
Run dmenuhandler with URL
.IP 3. 3
Select "queue download"
.IP 4. 3
Continue working while tsp downloads in background
.IP 5. 3
Check progress with `tsp` command
.RE
.SS YouTube Archiving
.RS
.IP 1. 3
Copy YouTube video URL
.IP 2. 3
Run dmenuhandler
.IP 3. 3
Select "queue youtube-dl"
.IP 4. 3
Video downloads with metadata in background
.IP 5. 3
Check tsp queue: `tsp -l`
.RE
.SH DEPENDENCIES
.TP
.B Required:
.RS
.IP \(bu 2
bash - Bash shell for script execution
.IP \(bu 2
rofi OR dmenu - Menu interface (at least one required)
.RE
.TP
.B Optional (menu options require these):
.RS
.IP \(bu 2
mpv - Media player for video/audio playback
.IP \(bu 2
clipboard (xclip/xsel) - Clipboard integration for copy URL
.IP \(bu 2
tsp (task spooler) - Download queue management
.IP \(bu 2
youtube-dl (or yt-dlp) - YouTube video downloading
.IP \(bu 2
feh - Image viewer for direct image links
.IP \(bu 2
w3m - Terminal web browser
.IP \(bu 2
Web browser - For browser option (firefox, chromium, etc.)
.RE
.PP
Menu options that require unavailable applications will still appear but will fail gracefully if selected.
.SH NOTES
.IP \(bu 2
Requires X11 window system for dmenu/rofi
.IP \(bu 2
Either rofi or dmenu must be installed
.IP \(bu 2
Optional dependencies enable additional menu options
.IP \(bu 2
All media playback runs in background (setsid)
.IP \(bu 2
mpv IPC sockets allow external control
.IP \(bu 2
Download queue managed by tsp (task spooler)
.IP \(bu 2
Clipboard operation requires xclip or similar
.IP \(bu 2
User can cancel by pressing Escape in menu
.IP \(bu 2
URL argument is required (script does nothing without URL)
.IP \(bu 2
Works with any URL type (http, https, file, etc.)
.SH TIPS
.SS Background Process Management
All background processes (mpv, feh, browser) use __setsid to properly detach from terminal, preventing terminal close from killing the process.
.SS mpv IPC Control
When using "mpv (loop)" or "mpv (float)", the IPC socket allows control:
.RS
.EX
# Pause/play
echo 'cycle pause' | socat - /tmp/mpvsoc[timestamp]

# Adjust volume
echo 'add volume 10' | socat - /tmp/mpvsoc[timestamp]

# Seek forward 10 seconds
echo 'seek 10' | socat - /tmp/mpvsoc[timestamp]
.EE
.RE
.SS Task Spooler Queue
Manage downloads queued with tsp:
.RS
.EX
# List queue
tsp -l

# Remove job
tsp -r [job_id]

# Clear finished
tsp -C

# Tail output
tsp -t [job_id]
.EE
.RE
.SH BUGS
Report bugs at: https://github.com/casjay-dotfiles/scripts/issues
.SH AUTHOR
Written by Jason Hempstead (CasjaysDev)
.SH COPYRIGHT
Copyright \(co 2022 Jason Hempstead, Casjays Developments
.br
License: WTFPL (Do What The F*** You Want To Public License)
.SH SEE ALSO
.BR dmenu (1),
.BR rofi (1),
.BR mpv (1),
.BR feh (1),
.BR w3m (1),
.BR youtube-dl (1),
.BR tsp (1)
.PP
Related tools:
.br
urlscan: https://github.com/firecat53/urlscan
.br
urlview: https://github.com/sigpipe/urlview
