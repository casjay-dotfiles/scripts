.TH GEN-APACHE "1" "December 2025" "gen-apache 202208070752-git" "User Commands"
.SH NAME
gen-apache \- Apache virtual host configuration generator with SSL support
.SH SYNOPSIS
.B gen-apache
[\\fI\\,DOMAIN\\fR] [\\fI\\,OPTIONS\\fR]
.SH DESCRIPTION
.B gen-apache
is an Apache virtual host configuration generator that automates the creation of Apache vhost configuration files with SSL/TLS support, document root setup, and HTML template deployment. It supports both Debian/Ubuntu (sites-enabled) and RHEL/CentOS (vhosts.d) directory structures, handles Let's Encrypt certificate integration, and provides an interactive wizard for configuration.
.PP
The script simplifies Apache virtual host management by providing automatic detection of SSL certificates (Let's Encrypt or self-signed), interactive configuration wizard with sensible defaults, HTML template deployment with variable substitution, automatic /etc/hosts entry creation, support for both user and system-wide installations, and comprehensive vhost configurations with HTTPS redirects and security headers.
.PP
gen-apache is particularly useful for web server administrators setting up new virtual hosts, developers creating local development environments, system administrators managing multiple Apache sites, automated deployment pipelines requiring vhost setup, and environments requiring consistent Apache configurations.
.SH USAGE
.B gen-apache mydomain.com
.PP
Create virtual host for mydomain.com with interactive wizard.
.PP
.B gen-apache list
.PP
List all configured server names and aliases.
.PP
.B gen-apache
.PP
Run interactive wizard (defaults to hostname -f).
.SH OPTIONS
.TP
.BR \\-\\-help
Display help message with usage information
.TP
.BR \\-\\-config
Generate or regenerate user configuration file
.TP
.BR \\-\\-version
Show script version information and exit
.TP
.BR \\-\\-options
Display all available command-line options
.TP
.BR \\-\\-debug
Enable debug mode with verbose output
.TP
.BR \\-\\-raw
Disable colorized output for plain text display
.SH ARGUMENTS
.TP
.B DOMAIN
The domain name for the virtual host (e.g., example.com, subdomain.example.com)
.TP
.B list
Display all configured ServerName and ServerAlias entries from existing vhost files
.SH VIRTUAL HOST CONFIGURATION
How gen-apache creates and configures Apache virtual hosts:
.SS SSL Certificate Detection
.RS
Automatic detection of SSL certificates:
.IP \\(bu 2
Checks /etc/letsencrypt/live for Let's Encrypt certificates
.IP \\(bu 2
Uses Let's Encrypt certs if available
.IP \\(bu 2
Falls back to self-signed /etc/ssl/CA/CasjaysDev certificates
.IP \\(bu 2
Creates symlink: /etc/letsencrypt/live/domain → hostname FQDN
.IP \\(bu 2
Supports both SSL and non-SSL configurations
.RE
.SS Directory Structures
.RS
Supports multiple Apache directory layouts:
.PP
.B Debian/Ubuntu:
.RS
.IP \\(bu 2
Vhost configs: /etc/apache2/sites-enabled/
.IP \\(bu 2
Document root: /var/www/html/
.IP \\(bu 2
Sites enabled via a2ensite command
.RE
.PP
.B RHEL/CentOS/Fedora:
.RS
.IP \\(bu 2
Vhost configs: /etc/httpd/conf/vhosts.d/
.IP \\(bu 2
Document root: /var/www/html/
.IP \\(bu 2
Direct config file placement
.RE
.PP
.B User Installation:
.RS
.IP \\(bu 2
Vhost configs: ~/.config/myscripts/gen-apache/files/vhosts/
.IP \\(bu 2
Document root: ~/.config/myscripts/gen-apache/files/www/
.IP \\(bu 2
For testing and development
.RE
.RE
.SS Configuration Wizard
.RS
Interactive prompts during setup:
.EX
1. Domain name (default: hostname -f)
2. SSL support (yes/no)
3. Local IP address (auto-calculated from /etc/hosts)
4. DocumentRoot directory
5. Apache vhost directory location
.EE
.IP \\(bu 2
All prompts have sensible defaults
.IP \\(bu 2
Auto-detection of existing configuration
.IP \\(bu 2
IP address auto-increment for multiple vhosts
.IP \\(bu 2
Directory creation with permission handling
.RE
.SS HTML Template Deployment
.RS
If CASJAYSDEVDIR templates exist:
.IP \\(bu 2
Copies HTML templates to DocumentRoot
.IP \\(bu 2
Performs variable substitution:
.RS
.IP \\(bu 4
GEN_SCRIPT_REPLACE_DOMAIN → domain name
.IP \\(bu 4
GEN_SCRIPT_REPLACE_YEAR → current year
.IP \\(bu 4
GEN_SCRIPT_REPLACE_HTMLROOT → document root path
.IP \\(bu 4
GEN_SCRIPT_REPLACE_MODIFIED → modification timestamp
.IP \\(bu 4
GEN_SCRIPT_REPLACE_TITLE → site title
.IP \\(bu 4
GEN_SCRIPT_REPLACE_BODY → welcome message
.IP \\(bu 4
GEN_SCRIPT_REPLACE_AUTHOR → author name
.RE
.IP \\(bu 2
Creates ready-to-use website structure
.RE
.SH SSL VIRTUAL HOST TEMPLATES
Apache virtual host configurations generated:
.SS Let's Encrypt SSL Configuration
.RS
Generated when Let's Encrypt certificates are available:
.EX
<IfModule mod_ssl.c>
<VirtualHost {IP}:8443>
ServerName domain.com
ServerAdmin webmaster@domain.com
DocumentRoot "/var/www/html/domain.com"

## LE Certs
SSLEngine on
SSLCertificateFile /etc/letsencrypt/live/domain/cert.pem
SSLCertificateKeyFile /etc/letsencrypt/live/domain/privkey.pem
SSLCertificateChainFile /etc/letsencrypt/live/domain/fullchain.pem

## Rewrites
RewriteEngine On
RewriteCond %{HTTPS} !=on
RewriteRule ^/?(.*) https://%{SERVER_NAME}/\\$1 [R,L]

## Set Proxy headers
<IfModule mod_proxy.c>
ProxyAddHeaders On
</IfModule>
</VirtualHost>
</IfModule>
.EE
.RE
.SS Self-Signed SSL Configuration
.RS
Generated when Let's Encrypt is not available:
.EX
<IfModule mod_ssl.c>
<VirtualHost _default_:8443>
ServerName domain.com
ServerAdmin webmaster@domain.com
DocumentRoot "/var/www/html/domain.com"

## Self-signed cert
SSLEngine on
SSLCertificateFile /etc/ssl/CA/CasjaysDev/certs/localhost.crt
SSLCertificateKeyFile /etc/ssl/CA/CasjaysDev/private/localhost.key

## Rewrites
RewriteEngine On
RewriteCond %{HTTPS} !=on
RewriteRule ^/?(.*) https://%{SERVER_NAME}/\\$1 [R,L]

<IfModule mod_proxy.c>
ProxyAddHeaders On
</IfModule>
</VirtualHost>
</IfModule>
.EE
.RE
.SS Non-SSL Configuration
.RS
Generated when SSL is explicitly disabled:
.EX
<VirtualHost _default_:81>
ServerName domain.com
ServerAdmin webmaster@domain.com
DocumentRoot "/var/www/html/domain.com"
</VirtualHost>
.EE
.RE
.SH LOCAL IP ADDRESS MANAGEMENT
How gen-apache manages IP addresses for virtual hosts:
.SS IP Auto-Calculation
.RS
.IP \\(bu 2
Searches /etc/hosts for existing gen-apache entries
.IP \\(bu 2
Finds highest IP in configured range
.IP \\(bu 2
Auto-increments by 1 for new vhost
.IP \\(bu 2
Default starting IP: 127.0.2.1
.IP \\(bu 2
Prevents IP conflicts between vhosts
.RE
.SS /etc/hosts Integration
.RS
.IP \\(bu 2
Automatically adds entries to /etc/hosts (requires sudo)
.IP \\(bu 2
Format: {IP_ADDRESS}      {DOMAIN_NAME}
.IP \\(bu 2
Enables local name resolution
.IP \\(bu 2
Supports name-based virtual hosting
.RE
.SH EXAMPLES
.TP
.B gen-apache mysite.local
Create virtual host for mysite.local with interactive wizard
.TP
.B gen-apache dev.example.com
Create virtual host for dev.example.com
.TP
.B gen-apache list
List all configured ServerName and ServerAlias entries
.TP
.B gen-apache --config
Generate or regenerate configuration file
.TP
.B gen-apache
Run with defaults (uses hostname -f as domain)
.SH FILES
.TP
.B ~/.config/myscripts/gen-apache/settings.conf
User configuration file
.TP
.B ~/.config/myscripts/gen-apache/files/vhosts/
User vhost configuration storage
.TP
.B ~/.config/myscripts/gen-apache/files/www/
User document root storage
.TP
.B ~/.local/share/myscripts/gen-apache/backups/
Configuration backup directory
.TP
.B ~/.local/log/gen-apache/
Log file directory
.TP
.B ~/.local/tmp/system_scripts/gen-apache/
Temporary files directory
.TP
.B ~/.cache/gen-apache/
Cache directory
.TP
.B /etc/apache2/sites-enabled/
Debian/Ubuntu system vhost directory
.TP
.B /etc/httpd/conf/vhosts.d/
RHEL/CentOS system vhost directory
.TP
.B /var/www/html/
System document root directory
.TP
.B /etc/hosts
System hostname resolution file (modified by script)
.TP
.B /etc/letsencrypt/live/
Let's Encrypt certificate directory
.SH ENVIRONMENT VARIABLES
.TP
.B GEN_APACHE_AUTHOR
Author name for template substitution (default: $USER)
.TP
.B GEN_APACHE_PORT_SSL
SSL/TLS port number (default: 8443)
.TP
.B GEN_APACHE_PORT_NONSSL
Non-SSL HTTP port number (default: 81)
.TP
.B GEN_APACHE_WWW_USER_DIR
User document root directory (default: ~/.config/myscripts/gen-apache/files/www)
.TP
.B GEN_APACHE_VHOST_USER_DIR
User vhost config directory (default: ~/.config/myscripts/gen-apache/files/vhosts)
.TP
.B GEN_APACHE_WWW_SYSTEM_DIR_ROOT
System document root (default: /var/www/html)
.TP
.B GEN_APACHE_VHOST_SYSTEM_DIR
System vhost directory (default: /etc/httpd/vhosts.d)
.TP
.B GEN_APACHE_LOCAL_IP
Starting IP address for vhosts (default: 127.0.2.1)
.TP
.B GEN_APACHE_DOMAIN
Domain name for virtual host
.TP
.B GEN_APACHE_SSL
SSL enabled (yes/no)
.TP
.B GEN_APACHE_NOTIFY_ENABLED
Enable/disable desktop notifications (default: yes)
.TP
.B GEN_APACHE_OUTPUT_COLOR_1
Primary output color code (default: 33 for yellow)
.TP
.B GEN_APACHE_OUTPUT_COLOR_2
Secondary output color code (default: 5 for magenta)
.TP
.B GEN_APACHE_OUTPUT_COLOR_GOOD
Success message color (default: 2 for green)
.TP
.B GEN_APACHE_OUTPUT_COLOR_ERROR
Error message color (default: 1 for red)
.SH CONFIGURATION FILE
The configuration file located at ~/.config/myscripts/gen-apache/settings.conf supports the following settings:
.PP
.RS 4
.EX
# Virtual host settings
GEN_APACHE_AUTHOR="username"
GEN_APACHE_PORT_SSL="8443"
GEN_APACHE_PORT_NONSSL="81"
GEN_APACHE_WWW_USER_DIR="$HOME/.config/myscripts/gen-apache/files/www"
GEN_APACHE_VHOST_USER_DIR="$HOME/.config/myscripts/gen-apache/files/vhosts"
GEN_APACHE_WWW_SYSTEM_DIR_ROOT="/var/www/html"
GEN_APACHE_VHOST_SYSTEM_DIR="/etc/httpd/vhosts.d"
GEN_APACHE_LOCAL_IP="127.0.2.1"

# Notification settings
GEN_APACHE_NOTIFY_ENABLED="yes"

# Output colorization
GEN_APACHE_OUTPUT_COLOR_1="33"
GEN_APACHE_OUTPUT_COLOR_2="5"
GEN_APACHE_OUTPUT_COLOR_GOOD="2"
GEN_APACHE_OUTPUT_COLOR_ERROR="1"
.EE
.RE
.SH EXIT STATUS
.TP
.B 0
Success - virtual host created successfully
.TP
.B 1
Error - configuration failed or missing required parameters
.SH NOTES
.IP \\(bu 2
Requires sudo access for system-wide installation
.IP \\(bu 2
Modifies /etc/hosts for local domain resolution
.IP \\(bu 2
Creates directories if they don't exist
.IP \\(bu 2
Supports both user and system-wide installations
.IP \\(bu 2
SSL ports default to 8443 to avoid conflicts with system Apache
.IP \\(bu 2
Non-SSL ports default to 81 to avoid port 80 conflicts
.IP \\(bu 2
Let's Encrypt certificates take precedence over self-signed
.IP \\(bu 2
IP addresses auto-increment from 127.0.2.1
.IP \\(bu 2
Interactive wizard can be skipped with environment variables
.IP \\(bu 2
Template deployment requires CASJAYSDEVDIR templates
.SH TIPS
.SS Local Development Setup
.RS
.EX
# Create development vhost
gen-apache dev.myapp.local

# Wizard prompts:
# Domain: dev.myapp.local
# SSL: yes
# IP: 127.0.2.1 (auto)
# DocumentRoot: /var/www/html/dev.myapp.local
# Vhost dir: /etc/httpd/conf/vhosts.d

# Access site at https://dev.myapp.local:8443
.EE
.RE
.SS Multiple Virtual Hosts
.RS
.EX
# First vhost
gen-apache site1.local  # IP: 127.0.2.1

# Second vhost
gen-apache site2.local  # IP: 127.0.2.2 (auto-incremented)

# Third vhost
gen-apache site3.local  # IP: 127.0.2.3 (auto-incremented)

# List all vhosts
gen-apache list
.EE
.RE
.SS Automated Setup
.RS
.EX
# Non-interactive installation using environment variables
export GEN_APACHE_DOMAIN="auto.example.com"
export GEN_APACHE_SSL="yes"
export GEN_APACHE_LOCAL_IP="127.0.2.10"
export GEN_APACHE_WWW_USER_DIR="/var/www/html/auto.example.com"
export GEN_APACHE_VHOST_SYSTEM_DIR="/etc/httpd/conf/vhosts.d"
gen-apache auto.example.com

# For deployment scripts and automation
.EE
.RE
.SS SSL Certificate Management
.RS
.EX
# Check for Let's Encrypt certificates
ls -la /etc/letsencrypt/live/

# Generate Let's Encrypt cert before gen-apache
sudo certbot certonly --standalone -d mysite.com

# Run gen-apache (will auto-detect LE cert)
gen-apache mysite.com

# Verify SSL configuration
sudo apache2ctl configtest  # Debian/Ubuntu
sudo apachectl configtest   # RHEL/CentOS
.EE
.RE
.SH USE CASES
.SS Web Development
.RS
.IP \\(bu 2
Create local development environments for web applications
.IP \\(bu 2
Test multiple sites with different domain names
.IP \\(bu 2
SSL/TLS testing with self-signed certificates
.IP \\(bu 2
Rapid prototype deployment with templates
.IP \\(bu 2
Multi-project development on single workstation
.RE
.SS System Administration
.RS
.IP \\(bu 2
Standardized virtual host configuration
.IP \\(bu 2
Consistent Apache setup across servers
.IP \\(bu 2
Automated deployment in configuration management
.IP \\(bu 2
Quick site provisioning for clients
.IP \\(bu 2
Template-based site generation
.RE
.SS Testing and Staging
.RS
.IP \\(bu 2
Create staging environments for production sites
.IP \\(bu 2
Test Apache configurations before production
.IP \\(bu 2
Verify SSL certificate integration
.IP \\(bu 2
Multi-environment testing (dev, test, stage)
.IP \\(bu 2
Isolated testing with unique IP addresses
.RE
.SH TROUBLESHOOTING
.SS Virtual Host Not Created
.RS
.IP \\(bu 2
Check sudo access: sudo -v
.IP \\(bu 2
Verify Apache directory exists: ls -la /etc/httpd/conf/vhosts.d
.IP \\(bu 2
Ensure domain name is valid (no spaces, proper format)
.IP \\(bu 2
Check file permissions on config directories
.IP \\(bu 2
Review error messages for missing parameters
.RE
.SS SSL Certificate Errors
.RS
.IP \\(bu 2
Verify Let's Encrypt directory: ls /etc/letsencrypt/live
.IP \\(bu 2
Check self-signed certs: ls /etc/ssl/CA/CasjaysDev
.IP \\(bu 2
Ensure certificate files are readable
.IP \\(bu 2
Test Apache SSL module: apache2ctl -M | grep ssl
.IP \\(bu 2
Review SSL paths in generated config file
.RE
.SS IP Address Conflicts
.RS
.IP \\(bu 2
Check /etc/hosts for conflicting entries
.IP \\(bu 2
Verify IP auto-increment calculation
.IP \\(bu 2
Manually specify IP with GEN_APACHE_LOCAL_IP
.IP \\(bu 2
Ensure IP is in 127.0.0.0/8 range for local testing
.IP \\(bu 2
Check for duplicate vhost configurations
.RE
.SS Apache Won't Start
.RS
.IP \\(bu 2
Test configuration: apache2ctl configtest
.IP \\(bu 2
Check syntax errors in generated vhost file
.IP \\(bu 2
Verify DocumentRoot directory exists
.IP \\(bu 2
Ensure ports are not already in use: netstat -tlnp | grep :8443
.IP \\(bu 2
Review Apache error logs: tail -f /var/log/apache2/error.log
.RE
.SS Template Deployment Failed
.RS
.IP \\(bu 2
Verify CASJAYSDEVDIR is set and valid
.IP \\(bu 2
Check templates exist: ls $CASJAYSDEVDIR/templates/html
.IP \\(bu 2
Ensure write permissions on DocumentRoot
.IP \\(bu 2
Verify sed/gsed is installed for substitution
.IP \\(bu 2
Check for disk space: df -h
.RE
.SH DEPENDENCIES
.TP
.B Required:
.RS
.IP \\(bu 2
bash - Bash shell for script execution
.IP \\(bu 2
apache2 or httpd - Apache web server
.IP \\(bu 2
sudo - Privilege elevation for system files
.IP \\(bu 2
sed or gsed - Text substitution in templates
.IP \\(bu 2
grep - Pattern matching for config parsing
.IP \\(bu 2
mkdir - Directory creation
.IP \\(bu 2
tee - Output redirection to /etc/hosts
.RE
.TP
.B Optional:
.RS
.IP \\(bu 2
certbot - Let's Encrypt certificate generation
.IP \\(bu 2
a2ensite - Debian/Ubuntu site enabling
.IP \\(bu 2
apache2ctl/apachectl - Apache control and testing
.IP \\(bu 2
netstat - Port usage checking
.RE
.SH SECURITY CONSIDERATIONS
.SS Privilege Requirements
.RS
.IP \\(bu 2
Requires sudo for system-wide installation
.IP \\(bu 2
User installation mode for non-privileged users
.IP \\(bu 2
/etc/hosts modification needs root access
.IP \\(bu 2
System vhost directory creation requires sudo
.IP \\(bu 2
DocumentRoot in /var/www requires elevated privileges
.RE
.SS SSL/TLS Considerations
.RS
.IP \\(bu 2
Self-signed certificates not trusted by browsers
.IP \\(bu 2
Let's Encrypt certificates recommended for production
.IP \\(bu 2
Certificate private keys must be protected (0600)
.IP \\(bu 2
HTTPS redirects enforced in SSL templates
.IP \\(bu 2
HSTS headers commented out by default (enable manually)
.RE
.SS Best Practices
.RS
.IP \\(bu 2
Use Let's Encrypt for publicly accessible sites
.IP \\(bu 2
Restrict vhost access with appropriate firewall rules
.IP \\(bu 2
Review generated configuration before enabling
.IP \\(bu 2
Test configuration with apache2ctl configtest
.IP \\(bu 2
Keep Apache modules and packages updated
.IP \\(bu 2
Use strong SSL/TLS protocols (disable SSLv2/SSLv3)
.IP \\(bu 2
Enable security headers (HSTS, X-Frame-Options, etc.)
.RE
.SH BUGS
Report bugs at: https://github.com/casjay-dotfiles/scripts/issues
.SH AUTHOR
Written by Jason Hempstead (CasjaysDev)
.SH COPYRIGHT
Copyright \\(co 2022 Jason Hempstead, Casjays Developments
.br
License: LICENSE.md
.SH SEE ALSO
.BR apache2 (8),
.BR httpd (8),
.BR a2ensite (8),
.BR certbot (8)
.PP
Apache Virtual Host documentation:
.br
https://httpd.apache.org/docs/2.4/vhosts/
.PP
Let's Encrypt documentation:
.br
https://letsencrypt.org/getting-started/
