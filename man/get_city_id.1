.TH GET_CITY_ID "1" "December 2025" "get_city_id 202409241720-git" "User Commands"
.SH NAME
get_city_id \- Search and retrieve city IDs from global city database
.SH SYNOPSIS
.B get_city_id
[\fI\,SEARCH_TERM\fR] [\fI\,FILTER\fR] [\fI\,OPTIONS\fR]
.SH DESCRIPTION
.B get_city_id
is a city identification lookup tool that searches a cached global city database to find city IDs and geographic coordinates. It downloads and caches a comprehensive JSON database of cities worldwide (from lkozyr/CityList GitHub repository), then provides fast local searches with automatic cache management, expiration handling, and corruption detection.
.PP
The script simplifies city ID lookups by providing automatic database downloading and caching with 13-day refresh cycle, empty file and corruption detection with automatic redownload, JSON-based search supporting city names and country filters, geographic coordinate display (latitude/longitude), colorized output with formatted results, and intelligent multi-term search with optional country filtering.
.PP
get_city_id is particularly useful for weather API integration requiring city IDs (OpenWeatherMap compatible), geographic data lookup and coordinate retrieval, location-based service development, travel and mapping applications, and automated geographic data processing.
.SH USAGE
.B get_city_id "New York"
.PP
Search for all cities matching "New York".
.PP
.B get_city_id London UK
.PP
Search for London and filter results by UK.
.PP
.B get_city_id Paris --debug
.PP
Search with verbose debugging output.
.SH OPTIONS
.TP
.BR \-\-help
Display help message with usage information
.TP
.BR \-\-config
Generate or regenerate user configuration file
.TP
.BR \-\-version
Show script version information and exit
.TP
.BR \-\-options
Display all available command-line options
.TP
.BR \-\-debug
Enable debug mode with verbose output
.TP
.BR \-\-raw
Disable colorized output for plain text display
.TP
.BR \-\-silent
Suppress notifications
.TP
.BR \-\-dir " " \fI\,DIRECTORY\fR
Set working directory
.SH ARGUMENTS
.TP
.B SEARCH_TERM
City name or search term (required - can be multiple words)
.TP
.B FILTER
Optional filter term (usually country code or name)
.SH DATABASE MANAGEMENT
How get_city_id manages the city database cache:
.SS Initial Download
.RS
On first run, downloads database from GitHub:
.EX
URL: https://raw.githubusercontent.com/lkozyr/CityList/master/city.list.json
Cache: ~/.cache/get_city_id/city_ids.json
.EE
.IP \(bu 2
Comprehensive global city database
.IP \(bu 2
JSON format with city details
.IP \(bu 2
Includes coordinates, country, ID
.IP \(bu 2
Compatible with OpenWeatherMap API
.RE
.SS Cache Validation
.RS
Automatic validation on every search:
.IP \(bu 2
.B Age Check:
Database older than 13 days triggers refresh
.IP \(bu 2
.B Empty File Check:
Zero-byte files trigger redownload
.IP \(bu 2
.B Corruption Check:
Invalid JSON triggers redownload
.IP \(bu 2
.B Automatic Repair:
All validation failures trigger automatic fix
.RE
.SS Cache Expiration
.RS
.EX
# Check if file is older than 13 days
if [ -n "$(find "$GET_CITY_ID_CACHE_FILE" -mtime +14 -print)" ]; then
  rm -Rf "$GET_CITY_ID_CACHE_FILE"
  __update_id_cache
fi
.EE
.IP \(bu 2
Uses find -mtime +14 to detect old cache
.IP \(bu 2
Automatically removes expired cache
.IP \(bu 2
Downloads fresh database
.IP \(bu 2
Displays status: "Cache expired (>13 days), refreshing..."
.RE
.SS Corruption Detection
.RS
.EX
# Check if file is empty
if [ ! -s "$GET_CITY_ID_CACHE_FILE" ]; then
  rm -Rf "$GET_CITY_ID_CACHE_FILE"
  __update_id_cache
fi

# Check if valid JSON
if ! jq -e '.[0]' "$GET_CITY_ID_CACHE_FILE" >/dev/null 2>&1; then
  rm -Rf "$GET_CITY_ID_CACHE_FILE"
  __update_id_cache
fi
.EE
.IP \(bu 2
Detects zero-byte files with [ ! -s ]
.IP \(bu 2
Validates JSON structure with jq -e
.IP \(bu 2
Tests for array format .[0]
.IP \(bu 2
Displays status: "Cache file is empty/corrupted, redownloading..."
.RE
.SH SEARCH FUNCTIONALITY
How get_city_id searches the database:
.SS Single Term Search
.RS
Search for city name:
.EX
get_city_id "Tokyo"
.EE
.IP \(bu 2
Case-insensitive matching
.IP \(bu 2
Partial name matching supported
.IP \(bu 2
Returns all matching cities
.IP \(bu 2
Includes country and coordinates
.RE
.SS Multi-Word Search
.RS
Search with multiple words:
.EX
get_city_id "New York"
get_city_id "Los Angeles"
get_city_id "Saint Petersburg"
.EE
.IP \(bu 2
Handles spaces in city names
.IP \(bu 2
Matches complete phrase
.IP \(bu 2
Quote marks optional but recommended
.RE
.SS Filtered Search
.RS
Search with country filter:
.EX
get_city_id London UK
get_city_id Paris France
get_city_id Springfield US
.EE
.IP \(bu 2
First argument: city name (SEARCH_TERM)
.IP \(bu 2
Last argument: country filter (FILTER)
.IP \(bu 2
Filters results by country name or code
.IP \(bu 2
Reduces ambiguous results
.RE
.SH OUTPUT FORMAT
How get_city_id displays search results:
.SS JSON Result Format
.RS
Each result displayed as JSON:
.EX
{
  "name": "London",
  "country": "GB",
  "latitude": 51.5085,
  "longitude": -0.1257,
  "id": 2643743
}
.EE
.IP \(bu 2
.B name:
City name
.IP \(bu 2
.B country:
Country code (ISO 3166-1 alpha-2)
.IP \(bu 2
.B latitude:
Geographic latitude (decimal degrees)
.IP \(bu 2
.B longitude:
Geographic longitude (decimal degrees)
.IP \(bu 2
.B id:
Unique city identifier (OpenWeatherMap compatible)
.RE
.SS Colorized Display
.RS
.IP \(bu 2
Search summary in purple/magenta
.IP \(bu 2
Results in configured color (default: color 2)
.IP \(bu 2
Success messages in green
.IP \(bu 2
Error messages in red
.IP \(bu 2
Status updates in blue/yellow
.RE
.SS No Results
.RS
When search produces no matches:
.EX
Your search for Springfield produced no results
.EE
.IP \(bu 2
Clear error message
.IP \(bu 2
Includes search term in message
.IP \(bu 2
Exit code 1 for scripting
.RE
.SH EXAMPLES
.TP
.B get_city_id "Tokyo"
Search for Tokyo and display all matches
.TP
.B get_city_id London
Simple search without quotes (works for single words)
.TP
.B get_city_id "New York" US
Search for New York and filter by United States
.TP
.B get_city_id Paris France
Search for Paris and filter by France
.TP
.B get_city_id Springfield
Display all cities named Springfield worldwide
.TP
.B get_city_id "Los Angeles" | jq -r '.id'
Extract city ID using jq for scripting
.TP
.B get_city_id Berlin --raw > berlin.json
Save results without color formatting
.TP
.B get_city_id Moscow --debug
Debug mode to see cache validation process
.SH FILES
.TP
.B ~/.cache/get_city_id/city_ids.json
Cached city database (refreshed every 13 days)
.TP
.B ~/.config/myscripts/get_city_id/settings.conf
User configuration file
.TP
.B ~/.config/myscripts/get_city_id/cities.txt
Generated list of all city names (sorted)
.TP
.B ~/.config/myscripts/get_city_id/countries.txt
Generated list of all countries (sorted)
.TP
.B ~/.local/share/myscripts/get_city_id/backups/
Configuration backup directory
.TP
.B ~/.local/log/get_city_id/
Log file directory
.TP
.B ~/.local/log/get_city_id/error.log
Error log file
.TP
.B ~/.local/run/system_scripts/get_city_id/
Runtime directory
.TP
.B ~/.local/tmp/system_scripts/get_city_id/
Temporary files directory
.SH ENVIRONMENT VARIABLES
.TP
.B GET_CITY_ID_CACHE_FILE
Override default cache file location (default: ~/.cache/get_city_id/city_ids.json)
.TP
.B GET_CITY_ID_JSON
Override database source URL (default: GitHub lkozyr/CityList repository)
.TP
.B GET_CITY_ID_NOTIFY_ENABLED
Enable/disable desktop notifications (default: yes)
.TP
.B GET_CITY_ID_SILENT
Suppress all notifications when set to "true"
.TP
.B GET_CITY_ID_OUTPUT_COLOR_1
Primary output color code (default: 33 for yellow)
.TP
.B GET_CITY_ID_OUTPUT_COLOR_2
Secondary output color code (default: 5 for magenta)
.TP
.B GET_CITY_ID_OUTPUT_COLOR_GOOD
Success message color (default: 2 for green)
.TP
.B GET_CITY_ID_OUTPUT_COLOR_ERROR
Error message color (default: 1 for red)
.SH CONFIGURATION FILE
The configuration file located at ~/.config/myscripts/get_city_id/settings.conf supports the following settings:
.PP
.RS 4
.EX
# Cache settings
GET_CITY_ID_CACHE_FILE="~/.cache/get_city_id/city_ids.json"
GET_CITY_ID_JSON="https://raw.githubusercontent.com/lkozyr/CityList/master/city.list.json"

# Notification settings
GET_CITY_ID_NOTIFY_ENABLED="yes"

# Output colorization
GET_CITY_ID_OUTPUT_COLOR_1="33"
GET_CITY_ID_OUTPUT_COLOR_2="5"
GET_CITY_ID_OUTPUT_COLOR_GOOD="2"
GET_CITY_ID_OUTPUT_COLOR_ERROR="1"
.EE
.RE
.SH EXIT STATUS
.TP
.B 0
Success - city found and displayed
.TP
.B 1
Error - no results found or database download failed
.TP
.B 3
Error - bash command not found
.SH NOTES
.IP \(bu 2
Database cached locally for 13 days before refresh
.IP \(bu 2
Automatic corruption detection and repair
.IP \(bu 2
Empty file detection triggers redownload
.IP \(bu 2
Case-insensitive search matching
.IP \(bu 2
Partial name matching supported
.IP \(bu 2
Multiple cities with same name displayed
.IP \(bu 2
Country filter reduces ambiguous results
.IP \(bu 2
JSON output ideal for scripting and parsing
.IP \(bu 2
Compatible with OpenWeatherMap API city IDs
.IP \(bu 2
Requires internet connection for initial download and cache refresh
.SH TIPS
.SS Weather API Integration
.RS
.EX
# Get city ID for OpenWeatherMap API
CITY_ID=$(get_city_id "London" UK | jq -r '.id')
curl "https://api.openweathermap.org/data/2.5/weather?id=$CITY_ID&appid=YOUR_KEY"
.EE
.RE
.SS Multiple Results Handling
.RS
.EX
# Find specific Springfield by country
get_city_id Springfield US | jq -r 'select(.name=="Springfield" and .country=="US")'

# Get first result only
get_city_id Tokyo | jq -r '.[0]' 2>/dev/null || get_city_id Tokyo | head -1
.EE
.RE
.SS Batch Processing
.RS
.EX
# Process multiple cities
while IFS= read -r city; do
  get_city_id "$city" --raw >> city_ids.json
done < cities.txt

# Extract all IDs to file
for city in "London" "Paris" "Berlin" "Madrid"; do
  get_city_id "$city" | jq -r '.id'
done > city_ids.txt
.EE
.RE
.SS Cache Management
.RS
.EX
# Force cache refresh
rm ~/.cache/get_city_id/city_ids.json
get_city_id London

# Check cache age
ls -lh ~/.cache/get_city_id/city_ids.json
find ~/.cache/get_city_id/city_ids.json -mtime +14

# View cache statistics
du -h ~/.cache/get_city_id/city_ids.json
jq 'length' ~/.cache/get_city_id/city_ids.json  # Count cities
.EE
.RE
.SH USE CASES
.SS Weather Applications
.RS
.IP \(bu 2
Lookup city IDs for weather API calls (OpenWeatherMap, etc.)
.IP \(bu 2
Convert city names to geographic coordinates
.IP \(bu 2
Batch process multiple locations for weather data
.IP \(bu 2
Validate user-entered city names
.IP \(bu 2
Build location selection interfaces
.RE
.SS Geographic Data Processing
.RS
.IP \(bu 2
Extract latitude/longitude for mapping applications
.IP \(bu 2
Geocode city names to coordinates
.IP \(bu 2
Build location databases from city names
.IP \(bu 2
Validate geographic data entries
.IP \(bu 2
Convert between city names and IDs
.RE
.SS Development and Testing
.RS
.IP \(bu 2
Generate test data for location-based apps
.IP \(bu 2
Mock geographic API responses
.IP \(bu 2
Populate database seeds with real city data
.IP \(bu 2
Create location fixtures for unit tests
.IP \(bu 2
Validate location input in applications
.RE
.SS Scripting and Automation
.RS
.IP \(bu 2
Automate weather data collection for multiple cities
.IP \(bu 2
Build location-aware monitoring systems
.IP \(bu 2
Generate geographic reports
.IP \(bu 2
Process location data in shell scripts
.IP \(bu 2
Integration with other CLI tools via JSON output
.RE
.SH TROUBLESHOOTING
.SS No Results Found
.RS
.IP \(bu 2
Check spelling of city name
.IP \(bu 2
Try without country filter first
.IP \(bu 2
Use partial name (e.g., "York" instead of "New York")
.IP \(bu 2
Verify city exists in global database
.IP \(bu 2
Try common alternative spellings
.RE
.SS Cache Download Fails
.RS
.IP \(bu 2
Check internet connection
.IP \(bu 2
Verify GitHub is accessible
.IP \(bu 2
Check firewall settings
.IP \(bu 2
Try manual download: curl -L https://raw.githubusercontent.com/lkozyr/CityList/master/city.list.json
.IP \(bu 2
Verify ~/.cache/get_city_id directory is writable
.RE
.SS Corrupted Cache
.RS
.IP \(bu 2
Script automatically detects and redownloads
.IP \(bu 2
Manual fix: rm ~/.cache/get_city_id/city_ids.json && get_city_id London
.IP \(bu 2
Verify jq is installed for JSON validation
.IP \(bu 2
Check disk space: df -h ~/.cache
.RE
.SS JSON Parsing Errors
.RS
.IP \(bu 2
Install jq if missing: package manager install jq
.IP \(bu 2
Verify jq version: jq --version
.IP \(bu 2
Check cache file: jq '.[0]' ~/.cache/get_city_id/city_ids.json
.IP \(bu 2
Redownload cache if corrupted
.RE
.SH DATA SOURCE
.SS Database Information
.RS
.IP \(bu 2
.B Source:
GitHub repository lkozyr/CityList
.IP \(bu 2
.B URL:
https://github.com/lkozyr/CityList
.IP \(bu 2
.B Format:
JSON array of city objects
.IP \(bu 2
.B Compatibility:
OpenWeatherMap API city ID format
.IP \(bu 2
.B Coverage:
Global cities database
.RE
.SS Data Fields
.RS
Each city entry contains:
.IP \(bu 2
.B id:
Unique identifier (integer)
.IP \(bu 2
.B name:
City name (string)
.IP \(bu 2
.B country:
Country code (ISO 3166-1 alpha-2)
.IP \(bu 2
.B coord:
Coordinates object with lat/lon (decimals)
.RE
.SH DEPENDENCIES
.TP
.B Required:
.RS
.IP \(bu 2
bash - Bash shell for script execution
.IP \(bu 2
curl - HTTP client for database downloads
.IP \(bu 2
jq - JSON processor for parsing and filtering
.IP \(bu 2
grep - Pattern matching for search functionality
.IP \(bu 2
sort - Result sorting
.IP \(bu 2
find - Cache age detection
.RE
.SH BUGS
Report bugs at: https://github.com/casjay-dotfiles/scripts/issues
.SH AUTHOR
Written by Jason Hempstead (CasjaysDev)
.SH COPYRIGHT
Copyright \(co 2023 Jason Hempstead, Casjays Developments
.br
License: WTFPL (Do What The F*** You Want To Public License)
.SH SEE ALSO
.BR jq (1),
.BR curl (1),
.BR grep (1),
.BR find (1)
.PP
OpenWeatherMap API Documentation:
.br
https://openweathermap.org/current#cityid
.PP
City List Database:
.br
https://github.com/lkozyr/CityList
