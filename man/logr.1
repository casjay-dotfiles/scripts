.TH LOGR "1" "December 2025" "logr 202208121653-git" "User Commands"
.SH NAME
logr \- Command execution logging and monitoring utility with email notifications
.SH SYNOPSIS
.B logr
[\fI\,OPTIONS\fR] [\fI\,COMMAND\fR] [\fI\,ARGS\fR]
.PP
.B logr
.BR list
.PP
.B logr
.BR open
.PP
.B logr
.BR clean
.PP
.B logr
[\fI\,MODE\fR] [\fI\,NAME\fR] [\fI\,COMMAND\fR]
.PP
.B command
|
.B logr
.SH DESCRIPTION
.B logr
is a comprehensive logging wrapper that executes commands while capturing both stdout and stderr to organized log files. It provides automatic timestamping, colorized output removal for clean logs, email notifications on errors, pretty-formatted log versions, and stdin pipe support for flexible integration into shell workflows.
.PP
The script simplifies command logging by providing timestamped log file creation with unique filenames, separate error log capturing merged into main log, email notifications on command failure or errors, automatic log colorization removal (ANSI codes), pretty-formatted log versions for readability, symlink to latest log for each command name, configurable file manager integration for log browsing, stdin pipe support for logging command output, and multiple logging modes (show, noerr, err, silent).
.PP
logr is particularly useful for cron job logging and error notification, command execution auditing and debugging, automated task monitoring with email alerts, script wrapper for reliable execution tracking, and historical command output archiving.
.SH COMMANDS
.TP
.BR list
List all log files in the log directory. Displays file names of all .log and .err files stored in the configured log directory.
.TP
.BR open
Open the log directory in a file manager. Uses configured file manager or detects available options (myfilemanager, lf, vifm, thunar).
.TP
.BR clean
Clean all log files and directories. Removes entire log directory and recreates structure. Also removes legacy ~/.log and ~/.err files.
.TP
.BR show " " \fI\,NAME COMMAND\fR
Execute command with visible output to terminal and no logging. Useful for testing commands before enabling logging.
.TP
.BR noerr " " \fI\,NAME COMMAND\fR
Execute command logging only stderr (error output). Stdout passes through to terminal normally.
.TP
.BR err " " \fI\,NAME COMMAND\fR
Execute command logging only stdout (standard output). Stderr passes through to terminal normally.
.TP
.BR silent " " \fI\,NAME COMMAND\fR
Execute command logging both stdout and stderr without terminal output. Completely silent execution with full logging.
.TP
.BR name " " \fI\,NAME COMMAND\fR
Execute command with custom log file name. Overrides default name extraction from command.
.TP
.BR cron " " \fI\,NAME COMMAND\fR
.TQ
.BR eval " " \fI\,NAME COMMAND\fR
.TQ
.BR exec " " \fI\,NAME COMMAND\fR
Execute command with logging (aliases for default mode). All three behave identically to default logging mode.
.TP
.BR - | stdin
Log input from pipe. Automatically detected when stdin is a pipe.
.SH OPTIONS
.TP
.BR \-\-name " " \fI\,NAME\fR
Set custom log file base name (without timestamp and extension)
.TP
.BR \-\-dir " " \fI\,DIRECTORY\fR
Set working directory for command execution
.TP
.BR \-\-silent
Suppress desktop notifications during logging
.TP
.BR \-\-help
Display help message with usage information and exit
.TP
.BR \-\-config
Generate or regenerate user configuration file and exit
.TP
.BR \-\-version
Show script version information and exit
.TP
.BR \-\-options
Display all available command-line options and exit
.TP
.BR \-\-debug
Enable debug mode with verbose output and tracing
.TP
.BR \-\-raw
Disable colorized output for plain text display
.TP
.BR \-\-completions " " \fI\,TYPE\fR
Generate completion strings for shell integration (short, long, array, list)
.SH LOG FILE STRUCTURE
How logr organizes and names log files:
.SS File Naming Convention
.RS
.EX
# Default format
<name>-<timestamp>.log
<name>-<timestamp>.err

# Example
backup-12092025-1430.log
backup-12092025-1430.err

# Timestamp format (LOGR_DATE_FMT)
MMDDYYYY-HHMM (default: %m%d%Y-%H%M)
.EE
.IP \(bu 2
Name extracted from first argument or command
.IP \(bu 2
Timestamp added automatically to prevent overwrites
.IP \(bu 2
.log for combined stdout+stderr output
.IP \(bu 2
.err for temporary stderr capture (merged after)
.IP \(bu 2
Symlink created: <name>_latest → most recent log
.RE
.SS Directory Structure
.RS
.EX
~/.local/log/logr/                  # Main log directory
├── backup-12092025-1430.log        # Combined log file
├── backup_latest                   # Symlink to latest backup log
├── script-12092025-1445.log
├── script_latest
└── pretty/                         # Pretty-formatted versions
    ├── backup-12092025-1430.log
    └── script-12092025-1445.log
.EE
.IP \(bu 2
All logs stored in LOGR_LOG_DIR (default: ~/.local/log/logr/)
.IP \(bu 2
Pretty directory contains ANSI-stripped formatted logs
.IP \(bu 2
Symlinks provide quick access to latest run
.IP \(bu 2
Error files (.err) automatically deleted after merge
.RE
.SS Log File Format
.RS
.EX
# Log file header
logr started <name> on Dec 09, 2025 at 14:30
Full command is: <command-line>

<command output>

# Log file footer
command exited with code: <exit-code> on Dec 09, 2025 at 14:32
.EE
.IP \(bu 2
Header includes start timestamp and full command
.IP \(bu 2
Body contains all command output (stdout + stderr merged)
.IP \(bu 2
Footer includes exit code and end timestamp
.IP \(bu 2
ANSI color codes removed during cleanup
.RE
.SH LOGGING MODES
How logr handles different logging scenarios:
.SS Default Logging Mode
.RS
.EX
logr mycommand arg1 arg2
.EE
.IP \(bu 2
Captures both stdout and stderr to log files
.IP \(bu 2
No output to terminal during execution
.IP \(bu 2
Creates <name>-<timestamp>.log and .err files
.IP \(bu 2
Merges error file into main log after completion
.IP \(bu 2
Sends email notification if errors occurred
.IP \(bu 2
Desktop notification on completion
.RE
.SS Show Mode
.RS
.EX
logr show backup rsync -av /src /dst
.EE
.IP \(bu 2
Displays all output to terminal in real-time
.IP \(bu 2
No log files created
.IP \(bu 2
Useful for testing commands before logging
.IP \(bu 2
Shows full command execution
.IP \(bu 2
Exit code passed through
.RE
.SS NoErr Mode (Stderr Only)
.RS
.EX
logr noerr script ./myscript.sh
.EE
.IP \(bu 2
Logs only stderr (error output)
.IP \(bu 2
Stdout displays normally to terminal
.IP \(bu 2
Creates <name>-<timestamp>.err file
.IP \(bu 2
Useful when you want to see output but capture errors
.IP \(bu 2
Email sent if errors logged
.RE
.SS Err Mode (Stdout Only)
.RS
.EX
logr err backup tar czf /backup.tar.gz /data
.EE
.IP \(bu 2
Logs only stdout (standard output)
.IP \(bu 2
Stderr displays normally to terminal
.IP \(bu 2
Creates <name>-<timestamp>.log file
.IP \(bu 2
Useful when you want to see errors but capture output
.IP \(bu 2
No email notification (only logs stdout)
.RE
.SS Silent Mode
.RS
.EX
logr silent cronjob /usr/local/bin/backup.sh
.EE
.IP \(bu 2
Logs both stdout and stderr
.IP \(bu 2
No output to terminal (completely silent)
.IP \(bu 2
Perfect for cron jobs and background tasks
.IP \(bu 2
Email notification on errors
.IP \(bu 2
Desktop notifications suppressed
.RE
.SS Stdin Pipe Mode
.RS
.EX
echo "test output" | logr
cat file.txt | logr
command | logr --name mylog
.EE
.IP \(bu 2
Automatically detected when stdin is a pipe
.IP \(bu 2
Logs stdin content with timestamp header/footer
.IP \(bu 2
Displays piped content with colorization
.IP \(bu 2
Log name: "sdtin" unless --name specified
.IP \(bu 2
Useful for logging command chains
.RE
.SH EMAIL NOTIFICATIONS
How logr sends email notifications on errors:
.SS Email Trigger Conditions
.RS
.EX
# Email sent when:
1. Command exit code non-zero (command failed)
2. Error log file has content (errors occurred)
.EE
.IP \(bu 2
Requires mail command installed and configured
.IP \(bu 2
Only sends on errors (not on success)
.IP \(bu 2
Skipped if mail command not available
.IP \(bu 2
Configurable sender and recipient addresses
.RE
.SS Email Content
.RS
.EX
From: root@hostname (LOGR_EMAIL_FROM)
To: root@hostname (LOGR_EMAIL_TO)
Subject: logr: <command-name>

The <command-name> script has been ran on <hostname> and has failed.
The log can be found in ~/.local/log/logr/<logfile>
Check the log output below for info.

<error log contents>
.EE
.IP \(bu 2
Subject line includes command name for filtering
.IP \(bu 2
Body includes hostname and log file location
.IP \(bu 2
Full error log contents attached inline
.IP \(bu 2
Sender defaults to root@<fqdn>
.IP \(bu 2
Recipient defaults to root@<fqdn>
.RE
.SS Email Configuration
.RS
.EX
# Configuration file settings
LOGR_EMAIL_FROM="admin@example.com"
LOGR_EMAIL_TO="alerts@example.com"
LOGR_HOST_NAME="server.example.com"

# Environment variables
EMAIL_ERROR_FROM="admin@example.com"
EMAIL_ERROR_TO="alerts@example.com"
.EE
.IP \(bu 2
Configure in ~/.config/myscripts/logr/settings.conf
.IP \(bu 2
Requires working mail command (sendmail, postfix, etc.)
.IP \(bu 2
Test with: echo "test" | mail -s "Test" user@example.com
.IP \(bu 2
Failed emails saved to <name>.sent for debugging
.RE
.SH LOG CLEANUP PROCESS
How logr processes and cleans log files:
.SS ANSI Color Code Removal
.RS
.EX
# Before cleanup
\\033[1;32mSuccess\\033[0m

# After cleanup
Success
.EE
.IP \(bu 2
Removes all ANSI escape sequences for clean logs
.IP \(bu 2
Regex: s,\\x1B\\[[0-9;]*[a-zA-Z],,g
.IP \(bu 2
Applied to both .log and .err files
.IP \(bu 2
Makes logs suitable for email/archiving
.RE
.SS Pretty Log Generation
.RS
.EX
# Pretty log location
~/.local/log/logr/pretty/<name>-<timestamp>.log

# Copy of cleaned log with formatting preserved
.EE
.IP \(bu 2
Created in pretty/ subdirectory
.IP \(bu 2
Identical to cleaned main log
.IP \(bu 2
Useful for separate formatting/processing
.IP \(bu 2
Generated for every log file
.RE
.SS Error File Merging
.RS
.EX
# Process flow
1. Command execution creates .log and .err files
2. Stderr captured to .err file
3. Stdout captured to .log file
4. After completion: cat .err >> .log
5. Delete .err file (cleanup)
6. Result: Single .log file with all output
.EE
.IP \(bu 2
Error output merged into main log
.IP \(bu 2
Temporary .err file deleted after merge
.IP \(bu 2
Chronological order may not be perfect
.IP \(bu 2
Final log contains complete command output
.RE
.SS Latest Symlink
.RS
.EX
# Symlink creation
ln -sf ~/.local/log/logr/backup-12092025-1430.log \\
      ~/.local/log/logr/backup_latest
.EE
.IP \(bu 2
Created for each command name
.IP \(bu 2
Points to most recent log for that command
.IP \(bu 2
Updated on every execution
.IP \(bu 2
Useful for quick access to latest run
.RE
.SH EXAMPLES
.TP
.B logr backup rsync -av /src /dst
Log rsync backup command with full output capture
.TP
.B logr --name daily-backup /usr/local/bin/backup.sh
Execute backup script with custom log name
.TP
.B logr list
List all existing log files
.TP
.B logr open
Open log directory in file manager
.TP
.B logr clean
Remove all log files and recreate directory structure
.TP
.B logr show test-script ./test.sh
Run test script with visible output (no logging)
.TP
.B logr silent cron-job /usr/local/bin/cleanup.sh
Execute cleanup script silently for cron (no terminal output)
.TP
.B logr noerr compile make all
Show compilation output but log errors only
.TP
.B logr err verbose-script ./script.sh --verbose
Show errors but log verbose output
.TP
.B cat /var/log/syslog | logr
Log syslog contents via pipe
.TP
.B command | logr --name command-output
Log piped command output with custom name
.TP
.B logr --dir /tmp script ./process-files.sh
Execute script in /tmp directory with logging
.SH CRON INTEGRATION
Using logr with cron jobs for automated task logging:
.SS Basic Cron Job
.RS
.EX
# Crontab entry
0 2 * * * logr backup /usr/local/bin/backup.sh

# What happens:
- Executes backup.sh at 2:00 AM daily
- Logs to ~/.local/log/logr/backup-<timestamp>.log
- Sends email if backup fails or errors
- No output to cron (silent execution)
- Symlink: backup_latest points to newest log
.EE
.RE
.SS Silent Cron Job
.RS
.EX
# Explicitly silent
0 3 * * * logr silent cleanup /usr/local/bin/cleanup.sh

# Ensures:
- No cron email (logr handles notifications)
- Full logging of stdout and stderr
- Email only on errors
- Desktop notifications suppressed
.EE
.RE
.SS Multiple Commands
.RS
.EX
# Log each command separately
0 4 * * * logr --name db-backup pg_dump mydb > /backup/db.sql
0 5 * * * logr --name file-backup tar czf /backup/files.tar.gz /data
0 6 * * * logr --name cleanup find /tmp -mtime +7 -delete

# Each creates separate log with unique name
# Email notifications independent per task
.EE
.RE
.SS Email Configuration
.RS
.EX
# ~/.config/myscripts/logr/settings.conf
LOGR_EMAIL_FROM="cron@server.example.com"
LOGR_EMAIL_TO="admin@example.com"
LOGR_HOST_NAME="server.example.com"

# All cron job failures email to admin@example.com
.EE
.RE
.SH FILES
.TP
.B ~/.local/log/logr/
Main log directory for all logged commands
.TP
.B ~/.local/log/logr/pretty/
Pretty-formatted log directory (ANSI codes removed)
.TP
.B ~/.config/myscripts/logr/settings.conf
User configuration file
.TP
.B ~/.local/share/myscripts/logr/backups/
Configuration backup directory
.TP
.B ~/.local/tmp/system_scripts/logr/
Temporary files directory
.TP
.B ~/.cache/logr/
Cache directory
.TP
.B <name>_latest
Symlink to latest log for each command name
.TP
.B <name>.sent
Failed email log (created when email send fails)
.SH ENVIRONMENT VARIABLES
.TP
.B LOGR_LOG_DIR
Main log directory (default: ~/.local/log/logr/)
.TP
.B LOGR_FILE_MANAGER
File manager for log directory browsing
.TP
.B LOGR_HOST_NAME
Hostname for email notifications (default: hostname -f)
.TP
.B LOGR_DATE_FMT
Date format for log filenames (default: %m%d%Y-%H%M)
.TP
.B LOGR_EMAIL_TO
Email recipient for error notifications (default: root@hostname)
.TP
.B LOGR_EMAIL_FROM
Email sender address (default: root@hostname)
.TP
.B EMAIL_ERROR_TO
Global email error recipient (fallback)
.TP
.B EMAIL_ERROR_FROM
Global email error sender (fallback)
.TP
.B LOGR_NOTIFY_ENABLED
Enable/disable desktop notifications (default: yes)
.TP
.B LOGR_NOTIFY_CLIENT_NAME
Application name for notifications (default: logr)
.TP
.B LOGR_NOTIFY_CLIENT_ICON
Icon for notifications (default: notification-new)
.TP
.B LOGR_NOTIFY_CLIENT_URGENCY
Notification urgency level (default: normal)
.TP
.B LOGR_GOOD_NAME
Success notification title (default: Great:)
.TP
.B LOGR_ERROR_NAME
Error notification title (default: Error:)
.TP
.B LOGR_GOOD_MESSAGE
Success message text (default: No errors reported)
.TP
.B LOGR_ERROR_MESSAGE
Error message text (default: Errors were reported)
.TP
.B LOGR_OUTPUT_COLOR_1
Primary output color code (default: 33 for yellow)
.TP
.B LOGR_OUTPUT_COLOR_2
Secondary output color code (default: 5 for magenta)
.TP
.B LOGR_OUTPUT_COLOR_GOOD
Success message color (default: 2 for green)
.TP
.B LOGR_OUTPUT_COLOR_ERROR
Error message color (default: 1 for red)
.TP
.B SEND_NOTIFICATION
Runtime notification control (set to "no" to disable)
.SH CONFIGURATION FILE
The configuration file located at ~/.config/myscripts/logr/settings.conf supports the following settings:
.PP
.RS 4
.EX
# File manager for log browsing
LOGR_FILE_MANAGER="thunar"

# Hostname for email
LOGR_HOST_NAME="server.example.com"

# Date format for log filenames
LOGR_DATE_FMT="%m%d%Y-%H%M"

# Email settings
LOGR_EMAIL_TO="admin@example.com"
LOGR_EMAIL_FROM="logr@server.example.com"

# Notification settings
LOGR_NOTIFY_ENABLED="yes"
LOGR_GOOD_NAME="Great:"
LOGR_ERROR_NAME="Error:"
LOGR_GOOD_MESSAGE="No errors reported"
LOGR_ERROR_MESSAGE="Errors were reported"
LOGR_NOTIFY_CLIENT_NAME="logr"
LOGR_NOTIFY_CLIENT_ICON="notification-new"
LOGR_NOTIFY_CLIENT_URGENCY="normal"

# Output colorization
LOGR_OUTPUT_COLOR_1="33"
LOGR_OUTPUT_COLOR_2="5"
LOGR_OUTPUT_COLOR_GOOD="2"
LOGR_OUTPUT_COLOR_ERROR="1"
.EE
.RE
.SH EXIT STATUS
.TP
.B 0
Success - command executed and exited with code 0
.TP
.B non-zero
Command failed - exit code from executed command passed through
.SH NOTES
.IP \(bu 2
Exit code from logged command passed through to caller
.IP \(bu 2
Email sent only on command failure or stderr content
.IP \(bu 2
ANSI color codes automatically removed from logs
.IP \(bu 2
Error log merged into main log after completion
.IP \(bu 2
Symlink created to latest log for each command
.IP \(bu 2
Stdin pipe automatically detected and logged
.IP \(bu 2
Desktop notifications for logging start/completion
.IP \(bu 2
Pretty-formatted logs in separate directory
.SH TIPS
.SS Quick Log Access
.RS
.EX
# View latest backup log
cat ~/.local/log/logr/backup_latest

# View latest with less
less ~/.local/log/logr/backup_latest

# Tail follow backup log
tail -f ~/.local/log/logr/backup_latest
.EE
.RE
.SS Shell Aliases
.RS
.EX
# Add to ~/.bashrc or ~/.zshrc
alias logr-backup='logr backup'
alias logr-list='logr list'
alias logr-open='logr open'
alias logr-clean='logr clean'

# Usage
logr-backup rsync -av /src /dst
logr-list
.EE
.RE
.SS Script Wrapper
.RS
.EX
#!/bin/bash
# Wrapper script with logging
logr --name myscript "$0" "$@"

# Or inline
logr mycommand /usr/local/bin/process.sh --args
.EE
.RE
.SS Email Testing
.RS
.EX
# Test mail configuration
echo "test" | mail -s "Test" user@example.com

# Test logr email
logr --name test false  # Force failure
# Check email received

# Debug failed email
cat ~/.local/log/logr/test.sent
.EE
.RE
.SS Custom Date Format
.RS
.EX
# Configuration file
LOGR_DATE_FMT="%Y%m%d-%H%M%S"

# Results in logs like:
mycommand-20251209-143045.log
.EE
.RE
.SH USE CASES
.SS Cron Job Monitoring
.RS
.IP \(bu 2
Wrap all cron jobs with logr
.IP \(bu 2
Email notifications on failures
.IP \(bu 2
Historical execution logs
.IP \(bu 2
Easy troubleshooting with latest symlinks
.RE
.SS Script Development
.RS
.IP \(bu 2
Test with 'show' mode first
.IP \(bu 2
Enable logging once working
.IP \(bu 2
Debug with full stdout/stderr capture
.IP \(bu 2
Track execution history
.RE
.SS Automated Tasks
.RS
.IP \(bu 2
Database backups with error notification
.IP \(bu 2
File synchronization monitoring
.IP \(bu 2
System maintenance task logging
.IP \(bu 2 Compliance and audit trails
.RE
.SS Command Chains
.RS
.IP \(bu 2
Log pipeline output
.IP \(bu 2
Capture multi-stage process output
.IP \(bu 2
Debug complex shell workflows
.IP \(bu 2
Archive command results
.RE
.SH TROUBLESHOOTING
.SS Email Not Sending
.RS
If emails not received on errors:
.IP \(bu 2
Check mail command installed: which mail
.IP \(bu 2
Test mail manually: echo "test" | mail -s "Test" user@example.com
.IP \(bu 2
Check mail server configuration
.IP \(bu 2
Review failed email in <name>.sent file
.IP \(bu 2
Check spam folder for logr emails
.RE
.SS Log Files Not Created
.RS
If no log files appear:
.IP \(bu 2
Check log directory exists: ls ~/.local/log/logr/
.IP \(bu 2
Check permissions: ls -ld ~/.local/log/logr/
.IP \(bu 2
Verify disk space: df -h ~/.local
.IP \(bu 2
Check for errors: logr --debug test echo "test"
.RE
.SS Command Not Executing
.RS
If wrapped command doesn't run:
.IP \(bu 2
Test with 'show' mode first: logr show test command
.IP \(bu 2
Check command exists: which command
.IP \(bu 2
Verify PATH in environment
.IP \(bu 2
Use absolute paths: logr backup /usr/bin/rsync args
.RE
.SS Exit Code Issues
.RS
If exit codes not passing through:
.IP \(bu 2
Verify with: logr test false; echo $?
.IP \(bu 2
Check command line: Full command shown in log header
.IP \(bu 2
Review log footer for actual exit code
.RE
.SH DEPENDENCIES
.TP
.B Required:
.RS
.IP \(bu 2
bash - Bash shell for script execution
.RE
.TP
.B Optional:
.RS
.IP \(bu 2
mail - Email client for error notifications
.IP \(bu 2
notifications - Desktop notification system
.IP \(bu 2
myfilemanager - File manager wrapper
.IP \(bu 2
lf - Lightweight file manager
.IP \(bu 2
vifm - Vi-like file manager
.IP \(bu 2
thunar - XFCE file manager
.RE
.SH BUGS
Report bugs at: https://github.com/casjay-dotfiles/scripts/issues
.SH AUTHOR
Written by Jason Hempstead (CasjaysDev)
.SH COPYRIGHT
Copyright \(co 2022 Jason Hempstead, Casjays Developments
.br
License: WTFPL (Do What The F*** You Want To Public License)
.SH SEE ALSO
.BR mail (1),
.BR cron (8),
.BR crontab (1),
.BR bash (1)
